<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NYC Photo Guide • SPA (Oct 3–4, 2025) — v6</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"/>
<style>
:root{--bg:#0b1220; --panel:#0f172a; --card:#0e1426; --text:#e6edf6; --muted:#9bb0c9; --border:#1f2a44; --shadow: rgba(0,0,0,.35);
--blue:#60a5fa; --amber:#fbbf24; --violet:#a78bfa; --rose:#fb7185; --teal:#2dd4bf;}
*{box-sizing:border-box}body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;background:#0b1220;color:var(--text)}
header{position:sticky;top:0;z-index:20;background:linear-gradient(90deg,#0b1220,#10203c);border-bottom:1px solid var(--border);box-shadow:0 4px 16px var(--shadow)}
.header-inner{max-width:1280px;margin:0 auto;display:flex;flex-wrap:wrap;gap:.6rem;align-items:center;padding:.7rem .9rem}
h1{font-size:1.06rem;margin:0 1rem 0 0;font-weight:800;letter-spacing:.02em}
.controls{display:flex;flex-wrap:wrap;gap:.45rem;align-items:center}
.controls input[type="date"], .controls input[type="search"], .controls select{background:#0b1326;color:var(--text);border:1px solid var(--border);padding:.45rem .6rem;border-radius:.5rem}
.controls button,.chip,label.chip{background:#0a1326;color:var(--text);border:1px solid var(--border);padding:.45rem .6rem;border-radius:.55rem;cursor:pointer;box-shadow:0 1px 3px var(--shadow)}
.controls button:hover{border-color:#314165}
main{max-width:1280px;margin:0 auto;display:grid;grid-template-columns:minmax(380px,560px) 1fr;gap:1rem;padding:1rem}
@media(max-width:980px){main{grid-template-columns:1fr} #mapWrap{position:static} #map{height:380px}}
.sidebar{display:grid;gap:1rem}
.panel{background:var(--panel);border:1px solid var(--border);border-radius:1rem;padding:1rem;box-shadow:0 10px 30px var(--shadow)}
#mapWrap{position:sticky;top:126px;height:calc(100vh - 150px)}
#map{height:100%;border:1px solid var(--border);border-radius:1rem}
.section-title{margin:.2rem 0 .6rem 0;font-size:.92rem;color:var(--muted);font-weight:800;text-transform:uppercase;letter-spacing:.08em}
.grid{display:grid;gap:.8rem}
.card{background:var(--card);border:1px solid var(--border);border-radius:1rem;padding:.9rem;display:grid;gap:.5rem;box-shadow:0 8px 20px var(--shadow);position:relative;overflow:hidden}
.card:before{content:"";position:absolute;inset:0 0 auto 0;height:4px;background:linear-gradient(90deg,var(--blue),var(--violet));opacity:.9}
.card-header{display:flex;justify-content:space-between;gap:.75rem;align-items:baseline}
.card h3{margin:.1rem 0;font-size:1.02rem}
.badges{display:flex;gap:.4rem;align-items:center;flex-wrap:wrap}
.badge{font-size:.75rem;padding:.2rem .45rem;border-radius:.4rem;border:1px solid var(--border);background:#0b1326;color:#9fb3c8}
.badge.block-Morning{background:#0b203a;color:#a5e3ff;border-color:#133b67}
.badge.block-Afternoon{background:#2a1a00;color:#ffd08a;border-color:#704d12}
.badge.block-Evening{background:#1a1025;color:#e5d5ff;border-color:#4b3b63}
.badge.block-Night{background:#1e0c12;color:#ffc1c9;border-color:#5c1c2c}
.summary-line{color:var(--muted);font-size:.9rem}
.kv{display:grid;grid-template-columns:140px 1fr;gap:.35rem .6rem}
.kv .k{color:var(--muted);font-weight:600}
.actions{display:flex;gap:.4rem;flex-wrap:wrap}
.actions a,.actions button{background:#0b1326;color:var(--text);border:1px solid var(--border);padding:.38rem .6rem;border-radius:.5rem;text-decoration:none;font-size:.86rem}
.expand-list{list-style:none;padding-left:0;margin:.2rem 0}
.expand-item{margin:.3rem 0;border:1px dashed #273853;border-radius:.6rem;background:#0a1428}
.expand-summary{display:flex;justify-content:space-between;align-items:center;width:100%;padding:.5rem .6rem;background:transparent;border:none;color:#cfe1ff;font-weight:700;cursor:pointer;text-align:left}
.expand-summary .hint{color:#94a7c7;font-weight:500}
.expand-body{display:none;padding:.5rem .8rem .7rem .8rem;color:#cdd9e8;border-top:1px dashed #273853}
.expand-item.open .expand-body{display:block}
.pillset{display:flex;gap:.4rem;flex-wrap:wrap}
.pill{display:inline-flex;align-items:center;gap:.35rem;padding:.25rem .5rem;border-radius:999px;border:1px solid var(--border);background:#0b1326;color:#cfe1ff;font-size:.78rem}
.edit-banner{position:sticky;top:94px;z-index:19;background:#10203c;border:1px dashed #3b4f77;color:#e6edf6;padding:.5rem .75rem;border-radius:.6rem}
.legend{display:flex;gap:.5rem;flex-wrap:wrap}
.legend .chip{border-color:#334155}

details{background:#0a1428;border:1px dashed #273853;border-radius:.8rem;padding:.55rem;margin-top:.4rem}
details summary{cursor:pointer;user-select:none;font-weight:700;color:#cfe1ff}
</style>
</head>
<body>
<header>
  <div class="header-inner">
    <h1>NYC Photo Guide — v6</h1>
    <div class="controls">
      <span class="chip">Visit days (NYC time):</span>
      <input id="dateA" type="date" value="2025-10-03"/>
      <input id="dateB" type="date" value="2025-10-04"/>
      <span class="chip">Show days:</span>
      <label class="chip" for="day1"><input id="day1" type="checkbox" name="day" value="2025-10-03" checked/> Fri 10/03</label>
      <label class="chip" for="day2"><input id="day2" type="checkbox" name="day" value="2025-10-04" checked/> Sat 10/04</label>
      <span class="chip">Blocks:</span>
      <label class="chip"><input type="checkbox" name="block" value="Morning" checked/> Morning</label>
      <label class="chip"><input type="checkbox" name="block" value="Afternoon" checked/> Afternoon</label>
      <label class="chip"><input type="checkbox" name="block" value="Evening" checked/> Evening</label>
      <label class="chip"><input type="checkbox" name="block" value="Night" checked/> Night</label>
      <span class="chip">Rank <span id="rankLabel">#1–#5</span></span>
      <input id="rankMin" type="range" min="1" max="5" value="1" title="Min rank"/>
      <input id="rankMax" type="range" min="1" max="5" value="5" title="Max rank"/>
      <label class="chip"><input type="checkbox" id="proOnly"/> Pro only</label>
      <label class="chip"><input type="checkbox" id="rain"/> Rain plan</label>
      <label class="chip"><input type="checkbox" id="wind"/> Wind‑safe</label>
      <input id="q" type="search" placeholder="Search..." />
      <button id="clear">Reset</button>
      <button id="expandAll">Expand all</button>
      <button id="collapseAll">Collapse all</button>
      <button id="exportCSV">Export CSV</button>
      <button id="exportKML">Export KML</button>
      <button id="print">Print</button>
      <button id="theme">Theme</button>
      <button id="editMode">Edit pins</button>
      <button id="editA">Edit anchor</button>
      <button id="editM">Edit micro</button>
      <button id="savePins">Save</button>
      <button id="resetPins">Reset edits</button>
      <button id="exportJSON">Export JSON</button>
      <label class="chip">Import <input type="file" id="importJSON" accept="application/json"/></label>
    </div>
  </div>
</header>

<main>
  <div class="sidebar">
    <div id="editBanner" class="edit-banner" style="display:none">
      Pin Edit mode is ON — <b id="editModeWhat">drag the active anchor</b> (blue marker) or micro‑pins (teal) for any visible card.
      Micro‑pins are stored as <i>offsets</i> from the anchor, so when you move the anchor they auto‑adjust.
      Your changes save to this browser and can be exported as JSON/KML/CSV.
    </div>
    <div id="lightpanels" class="grid"></div>
    <section class="panel">
      <div class="section-title">Rules & Reminders</div>
      <ul>
        <li>Observation decks often restrict <b>tripods</b>. Plan to shoot handheld or with a mini support.</li>
        <li>Grand Central / NYPL / Oculus interior: casual photos are fine; professional rigs/tripods usually <b>require permits</b>.</li>
        <li>Subways: photography permitted without lights/reflectors/tripods. Stay behind safety lines.</li>
        <li>Waterfront long exposures: check <b>NOAA “The Battery” tides</b> (link above); wind kills reflections.</li>
        <li>Use crosswalks/medians for street shots. Never step into active lanes for a frame.</li>
      </ul>
    </section>
    <div id="list" class="grid"></div>
  </div>

  <div id="mapWrap">
    <div id="map" class="panel"></div>
  </div>
</main>

<footer>SPA v6 — Multi‑anchor cards, anchor‑first editing (micro auto‑adjust), dynamic sunrise/civil times for any dates, and stable Google Maps links.</footer>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
<script>

// ---------- Constants & Utilities ----------
const DATA_VERSION = "v6";
const NYC = { lat: 40.7128, lon: -74.0060 };
const DAY_KEYS = ["2025-10-03", "2025-10-04"]; // keys used in dataset

let LOCATIONS = [{"id": "2025-10-03-Morning-1-94590", "day": "2025-10-03", "block": "Morning", "rank": 1, "name": "DUMBO \u2014 Washington & Water (Manhattan Bridge Keyhole)", "anchors": [{"label": "Keyhole \u2014 Wash & Water", "lat": 40.70339, "lon": -73.98953}], "activeAnchor": 0, "bearing": "NNE toward Manhattan Bridge/ESB", "gear": "24\u201370mm; CPL/ND", "notes": "Arrive pre\u2011dawn; ESB\u2011in\u2011arch alignment.", "rainFriendly": false, "windSafe": true, "waterfront": false, "pins": [{"title": "Mid\u2011block at Washington & Water (classic)", "detail": "ESB centered; stand on double\u2011yellow; keep arch tangent to ESB crown."}, {"title": "Toward Front St (tighter)", "detail": "Walk south to tighten the ESB gap; 70\u202fmm + crop; watch trucks."}, {"title": "Corner puddles (SW)", "detail": "Low angle puddles; kill CPL; tilt LCD up to complete reflection."}], "micro": [{"title": "Mid\u2011block centerline", "r": 0, "bearing": 0, "dir": "NNW", "detail": "Classic frame\u2014ESB centered in arch."}, {"title": "Toward Front St (tighter)", "r": 30, "bearing": 200, "dir": "NNW", "detail": "Tighter arch gap; 70\u202fmm + crop."}, {"title": "Corner puddles", "r": 18, "bearing": 230, "dir": "NNW", "detail": "Low puddles; smooth reflection; no CPL."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "Soft east light, clean air, and lower crowds.", "settings": "1/160\u20131/500 \u2022 f/4\u2013f/8 \u2022 ISO 100\u2013400 for crisp, low\u2011angle light"}, {"id": "2025-10-03-Morning-2-35533", "day": "2025-10-03", "block": "Morning", "rank": 2, "name": "Pebble Beach / Empire\u2013Fulton Ferry", "anchors": [{"label": "Pebble Beach steps", "lat": 40.70453, "lon": -73.99269}], "activeAnchor": 0, "bearing": "WSW toward Lower Manhattan", "gear": "16\u201324mm; 24\u201370mm; 3\u20136\u2011stop ND; tripod", "notes": "Gentle incoming tide for mirror edges.", "rainFriendly": false, "windSafe": false, "waterfront": true, "pins": [{"title": "Pebble steps (rocks FG)", "detail": "Seat round stones into the lower third; time an incoming ripple."}, {"title": "East railing (clean skyline)", "detail": "Slight tele to exclude beach; flat horizon."}, {"title": "Carousel glow (west)", "detail": "Blue\u2011hour reflections across the glass; 2\u20136\u202fs exposures."}], "micro": [{"title": "Beach steps", "r": 0, "bearing": 0, "dir": "WSW", "detail": "Sit on steps; stones FG; time the ripple."}, {"title": "Cove rail (east)", "r": 35, "bearing": 80, "dir": "WSW", "detail": "Clean skyline from rail; exclude beach."}, {"title": "Promenade to carousel", "r": 40, "bearing": 300, "dir": "W", "detail": "Blue\u2011hour carousel glow."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "Soft east light, clean air, and lower crowds.", "settings": "f/8\u2013f/11 \u2022 ISO 100 \u2022 2\u201330\u202fs with 3\u20136\u2011stop ND for water smoothing"}, {"id": "2025-10-03-Morning-3-92376", "day": "2025-10-03", "block": "Morning", "rank": 3, "name": "Brooklyn Heights Promenade", "anchors": [{"label": "Center benches", "lat": 40.6968889, "lon": -73.9968889}], "activeAnchor": 0, "bearing": "WSW across East River", "gear": "24\u201370mm", "notes": "Tele skyline compression; silhouettes on benches.", "rainFriendly": false, "windSafe": false, "waterfront": true, "pins": [{"title": "Center benches", "detail": "Clear the rail by standing between benches; bench line as lower frame."}, {"title": "Montague entrance (trees)", "detail": "Use foliage as vignette; slight tele at 70\u202fmm + crop."}, {"title": "Squibb Bridge overlook", "detail": "Higher vantage aligns pylons with One WTC; compress layers."}], "micro": [{"title": "Center benches", "r": 0, "bearing": 0, "dir": "WSW", "detail": "Centered skyline above rail."}, {"title": "Montague entrance", "r": 100, "bearing": 190, "dir": "WSW", "detail": "Tree\u2011framed skyline; 70\u202fmm + crop."}, {"title": "Squibb Bridge overlook", "r": 140, "bearing": 20, "dir": "WSW", "detail": "Higher vantage; align pylons."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "Soft east light, clean air, and lower crowds.", "settings": "f/8\u2013f/11 \u2022 ISO 100 \u2022 2\u201330\u202fs with 3\u20136\u2011stop ND for water smoothing"}, {"id": "2025-10-03-Morning-4-66325", "day": "2025-10-03", "block": "Morning", "rank": 4, "name": "Manhattan Bridge \u2014 Pedestrian Walkway (south)", "anchors": [{"label": "Mid\u2011span south walkway", "lat": 40.7132, "lon": -73.993}], "activeAnchor": 0, "bearing": "SW toward Financial District", "gear": "24\u201370mm; mini\u2011tripod", "notes": "Train streaks + skyline through fencing patterns.", "rainFriendly": false, "windSafe": false, "waterfront": false, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "Soft east light, clean air, and lower crowds.", "settings": "1/160\u20131/500 \u2022 f/4\u2013f/8 \u2022 ISO 100\u2013400 for crisp, low\u2011angle light"}, {"id": "2025-10-03-Morning-5-48974", "day": "2025-10-03", "block": "Morning", "rank": 5, "name": "Brooklyn Bridge \u2014 Walkway (center spans)", "anchors": [{"label": "First arch centerline", "lat": 40.7067, "lon": -73.9967}], "activeAnchor": 0, "bearing": "WNW toward Lower Manhattan", "gear": "16\u201324mm; clamp", "notes": "Cable symmetry; low angle wood planks foreground.", "rainFriendly": false, "windSafe": false, "waterfront": false, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "Soft east light, clean air, and lower crowds.", "settings": "1/160\u20131/500 \u2022 f/4\u2013f/8 \u2022 ISO 100\u2013400 for crisp, low\u2011angle light"}, {"id": "2025-10-03-Afternoon-1-72325", "day": "2025-10-03", "block": "Afternoon", "rank": 1, "name": "Grand Central Terminal \u2014 Main Concourse", "anchors": [{"label": "Main nave center", "lat": 40.75278, "lon": -73.97722}], "activeAnchor": 0, "bearing": "Interior (multi)", "gear": "16\u201324mm; 35/1.4; 50/1.8", "notes": "Motion blur at 1/4\u20131/2s; tripods require permit.", "rainFriendly": true, "windSafe": true, "waterfront": false, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "High, contrasty sun favors interiors & graphic street geometry.", "settings": "Handheld: 1/125\u20131/500 in shade \u2022 Interiors: 1/4\u20131/2\u202fs braced \u2022 ISO 100\u20131600 depending on light"}, {"id": "2025-10-03-Afternoon-2-9496", "day": "2025-10-03", "block": "Afternoon", "rank": 2, "name": "The Oculus & WTC Plaza", "anchors": [{"label": "Oculus \u2014 interior hall", "lat": 40.71265, "lon": -74.0099}, {"label": "WTC Plaza \u2014 Church St", "lat": 40.71205, "lon": -74.0106}], "activeAnchor": 0, "bearing": "Interior ribs + exterior plaza reflections", "gear": "16\u201324mm; 24\u201370mm", "notes": "Interior is tripod\u2011restricted; plaza allows long exposures.", "rainFriendly": true, "windSafe": true, "waterfront": false, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary nave/plaza frame", "r": 0, "bearing": 0, "dir": "W", "detail": "Primary composition from the active anchor."}, {"title": "Alternate angle", "r": 20, "bearing": 45, "dir": "NW", "detail": "Shift to change rib geometry / puddle placement."}, {"title": "Bonus reflection", "r": 25, "bearing": 300, "dir": "WSW", "detail": "Seek puddles; 2\u20136\u202fs at blue hour."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "High, contrasty sun favors interiors & graphic street geometry.", "settings": "Handheld: 1/125\u20131/500 in shade \u2022 Interiors: 1/4\u20131/2\u202fs braced \u2022 ISO 100\u20131600 depending on light"}, {"id": "2025-10-03-Afternoon-3-1712", "day": "2025-10-03", "block": "Afternoon", "rank": 3, "name": "NYPL Main Branch (Stephen A. Schwarzman)", "anchors": [{"label": "Fifth Ave steps", "lat": 40.7532, "lon": -73.9822}], "activeAnchor": 0, "bearing": "E/W fa\u00e7ades; interior symmetry", "gear": "24\u201370mm; 35/1.4; 50/1.8", "notes": "No flash/tripods inside; quiet portraits on steps.", "rainFriendly": true, "windSafe": true, "waterfront": false, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "High, contrasty sun favors interiors & graphic street geometry.", "settings": "Handheld: 1/125\u20131/500 in shade \u2022 Interiors: 1/4\u20131/2\u202fs braced \u2022 ISO 100\u20131600 depending on light"}, {"id": "2025-10-03-Afternoon-4-47178", "day": "2025-10-03", "block": "Afternoon", "rank": 4, "name": "Flatiron District (23rd & Broadway)", "anchors": [{"label": "Flatiron median wedge", "lat": 40.7411, "lon": -73.9897}], "activeAnchor": 0, "bearing": "NNE along 5th Ave", "gear": "24\u201370mm; 16\u201324mm", "notes": "Daytime streaks with ND; busy crosswalk geometry.", "rainFriendly": false, "windSafe": true, "waterfront": false, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "High, contrasty sun favors interiors & graphic street geometry.", "settings": "Handheld: 1/125\u20131/500 in shade \u2022 Interiors: 1/4\u20131/2\u202fs braced \u2022 ISO 100\u20131600 depending on light"}, {"id": "2025-10-03-Afternoon-5-6132", "day": "2025-10-03", "block": "Afternoon", "rank": 5, "name": "The High Line \u2014 10th Ave Overlook / Spur", "anchors": [{"label": "10th Ave Overlook", "lat": 40.7425, "lon": -74.0061}], "activeAnchor": 0, "bearing": "W to Hudson; S/N along 10th Ave", "gear": "24\u201370mm; 50/1.8", "notes": "Sun slicing between buildings; framed streets.", "rainFriendly": false, "windSafe": true, "waterfront": false, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "High, contrasty sun favors interiors & graphic street geometry.", "settings": "Handheld: 1/125\u20131/500 in shade \u2022 Interiors: 1/4\u20131/2\u202fs braced \u2022 ISO 100\u20131600 depending on light"}, {"id": "2025-10-03-Evening-1-23759", "day": "2025-10-03", "block": "Evening", "rank": 1, "name": "Top of the Rock \u2014 Observation Deck", "anchors": [{"label": "Top deck \u2014 south side", "lat": 40.7591, "lon": -73.9795}], "activeAnchor": 0, "bearing": "W & S (sunset, ESB)", "gear": "16\u201324mm; 24\u201370mm", "notes": "Arrive 60\u201390 min pre\u2011sunset; no tripods on deck.", "rainFriendly": false, "windSafe": true, "waterfront": false, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "Warm side/back light into sunset; blue\u2011hour glow.", "settings": "Golden hour: 1/200\u20131/500 for rim light \u2022 Blue hour: f/8\u2013f/16 \u2022 1\u201315\u202fs on tripod"}, {"id": "2025-10-03-Evening-2-91966", "day": "2025-10-03", "block": "Evening", "rank": 2, "name": "Gapstow Bridge \u2014 Central Park", "anchors": [{"label": "SE bank by rocks", "lat": 40.7641, "lon": -73.9739}], "activeAnchor": 0, "bearing": "NW toward Midtown", "gear": "24\u201370mm; 35/1.4", "notes": "Shoreline reflections; silhouettes on the bridge.", "rainFriendly": false, "windSafe": true, "waterfront": false, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "Warm side/back light into sunset; blue\u2011hour glow.", "settings": "Golden hour: 1/200\u20131/500 for rim light \u2022 Blue hour: f/8\u2013f/16 \u2022 1\u201315\u202fs on tripod"}, {"id": "2025-10-03-Evening-3-777", "day": "2025-10-03", "block": "Evening", "rank": 3, "name": "Brooklyn Bridge Park \u2014 Pier 1 (Pilings)", "anchors": [{"label": "Pier 1 bend", "lat": 40.7021, "lon": -73.9969}], "activeAnchor": 0, "bearing": "WSW to skyline", "gear": "16\u201324mm; 24\u201370mm; ND; tripod", "notes": "Repeating pilings FG; ferry streaks at blue hour.", "rainFriendly": false, "windSafe": false, "waterfront": true, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "Warm side/back light into sunset; blue\u2011hour glow.", "settings": "Golden hour: 1/200\u20131/500 for rim light \u2022 Blue hour: f/8\u2013f/16 \u2022 1\u201315\u202fs on tripod"}, {"id": "2025-10-03-Evening-4-59609", "day": "2025-10-03", "block": "Evening", "rank": 4, "name": "Roosevelt Island Tram & Queensboro Bridge", "anchors": [{"label": "2nd Ave Tram station", "lat": 40.7615, "lon": -73.9597}], "activeAnchor": 0, "bearing": "W toward Midtown", "gear": "24\u201370mm; 50/1.8", "notes": "Tram motion blur; bridge tower geometry.", "rainFriendly": false, "windSafe": true, "waterfront": false, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "Warm side/back light into sunset; blue\u2011hour glow.", "settings": "Golden hour: 1/200\u20131/500 for rim light \u2022 Blue hour: f/8\u2013f/16 \u2022 1\u201315\u202fs on tripod"}, {"id": "2025-10-03-Evening-5-50117", "day": "2025-10-03", "block": "Evening", "rank": 5, "name": "Belvedere Castle & Turtle Pond", "anchors": [{"label": "SE pond edge", "lat": 40.7794, "lon": -73.969}], "activeAnchor": 0, "bearing": "SE/NW options", "gear": "24\u201370mm; 16\u201324mm", "notes": "Castle silhouettes; pond reflections as light drops.", "rainFriendly": false, "windSafe": true, "waterfront": false, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "Warm side/back light into sunset; blue\u2011hour glow.", "settings": "Golden hour: 1/200\u20131/500 for rim light \u2022 Blue hour: f/8\u2013f/16 \u2022 1\u201315\u202fs on tripod"}, {"id": "2025-10-03-Night-1-21008", "day": "2025-10-03", "block": "Night", "rank": 1, "name": "Times Square \u2014 Duffy Square", "anchors": [{"label": "Red Steps", "lat": 40.758, "lon": -73.9855}], "activeAnchor": 0, "bearing": "Broadway & 7th Ave", "gear": "24\u201370mm; 35/1.4; 50/1.8; mini\u2011tripod", "notes": "Neon people blur 4\u201310s; portraits f/1.8\u20132.8.", "rainFriendly": true, "windSafe": true, "waterfront": false, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "Neon, light trails, and reflections\u2014perfect for long exposures.", "settings": "f/8\u2013f/11 \u2022 ISO 100 \u2022 8\u201320\u202fs for trails; or f/1.8\u2013f/2.8 \u2022 ISO 800\u20133200 for handheld portraits"}, {"id": "2025-10-03-Night-2-36848", "day": "2025-10-03", "block": "Night", "rank": 2, "name": "Tudor City Overpass (E 42nd St)", "anchors": [{"label": "Overpass centerline", "lat": 40.7495, "lon": -73.9725}], "activeAnchor": 0, "bearing": "WSW down 42nd St", "gear": "24\u201370mm; tripod; remote", "notes": "Chrysler crown + headlight trails 8\u201320s.", "rainFriendly": false, "windSafe": true, "waterfront": false, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "Neon, light trails, and reflections\u2014perfect for long exposures.", "settings": "f/8\u2013f/11 \u2022 ISO 100 \u2022 8\u201320\u202fs for trails; or f/1.8\u2013f/2.8 \u2022 ISO 800\u20133200 for handheld portraits"}, {"id": "2025-10-03-Night-3-58195", "day": "2025-10-03", "block": "Night", "rank": 3, "name": "Rockefeller Center \u2014 Channel Gardens", "anchors": [{"label": "South end by pool", "lat": 40.7586, "lon": -73.9787}], "activeAnchor": 0, "bearing": "S toward 30 Rock", "gear": "24\u201370mm; 35/1.4", "notes": "Flags, fountains, reflections; seasonal installs.", "rainFriendly": false, "windSafe": true, "waterfront": false, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "Neon, light trails, and reflections\u2014perfect for long exposures.", "settings": "f/8\u2013f/11 \u2022 ISO 100 \u2022 8\u201320\u202fs for trails; or f/1.8\u2013f/2.8 \u2022 ISO 800\u20133200 for handheld portraits"}, {"id": "2025-10-03-Night-4-34998", "day": "2025-10-03", "block": "Night", "rank": 4, "name": "Flatiron at Night (23rd & Broadway)", "anchors": [{"label": "Flatiron median night", "lat": 40.7411, "lon": -73.9897}], "activeAnchor": 0, "bearing": "NNE along 5th Ave", "gear": "24\u201370mm; tripod", "notes": "Taxi streaks; puddle mirrors near crosswalks.", "rainFriendly": false, "windSafe": true, "waterfront": false, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "Neon, light trails, and reflections\u2014perfect for long exposures.", "settings": "f/8\u2013f/11 \u2022 ISO 100 \u2022 8\u201320\u202fs for trails; or f/1.8\u2013f/2.8 \u2022 ISO 800\u20133200 for handheld portraits"}, {"id": "2025-10-03-Night-5-10676", "day": "2025-10-03", "block": "Night", "rank": 5, "name": "Brooklyn Bridge \u2014 Walkway (night symmetry)", "anchors": [{"label": "First arch night", "lat": 40.7067, "lon": -73.9967}], "activeAnchor": 0, "bearing": "WNW to skyline", "gear": "16\u201324mm; clamp", "notes": "Cable geometry; mind cyclists.", "rainFriendly": false, "windSafe": false, "waterfront": false, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "Neon, light trails, and reflections\u2014perfect for long exposures.", "settings": "f/8\u2013f/11 \u2022 ISO 100 \u2022 8\u201320\u202fs for trails; or f/1.8\u2013f/2.8 \u2022 ISO 800\u20133200 for handheld portraits"}, {"id": "2025-10-04-Morning-1-88461", "day": "2025-10-04", "block": "Morning", "rank": 1, "name": "Bethesda Terrace \u2014 Arcade", "anchors": [{"label": "Arcade centerline", "lat": 40.7741, "lon": -73.9701}], "activeAnchor": 0, "bearing": "N/S arcade axis", "gear": "24\u201370mm; 35/1.4", "notes": "Civil\u2011dawn start; vanishing arches; warm side\u2011light.", "rainFriendly": true, "windSafe": true, "waterfront": false, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "Soft east light, clean air, and lower crowds.", "settings": "1/160\u20131/500 \u2022 f/4\u2013f/8 \u2022 ISO 100\u2013400 for crisp, low\u2011angle light"}, {"id": "2025-10-04-Morning-2-86798", "day": "2025-10-04", "block": "Morning", "rank": 2, "name": "Bow Bridge \u2014 The Lake", "anchors": [{"label": "SE landing", "lat": 40.7755, "lon": -73.9703}], "activeAnchor": 0, "bearing": "W/NW across The Lake", "gear": "24\u201370mm; CPL", "notes": "Reflections; rowboats add scale; avoid mid\u2011bridge vibration.", "rainFriendly": false, "windSafe": true, "waterfront": false, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "Soft east light, clean air, and lower crowds.", "settings": "1/160\u20131/500 \u2022 f/4\u2013f/8 \u2022 ISO 100\u2013400 for crisp, low\u2011angle light"}, {"id": "2025-10-04-Morning-3-60070", "day": "2025-10-04", "block": "Morning", "rank": 3, "name": "The Mall / Literary Walk", "anchors": [{"label": "Mid\u2011Mall", "lat": 40.7735, "lon": -73.9719}], "activeAnchor": 0, "bearing": "S/N tree tunnel", "gear": "35/1.4; 50/1.8", "notes": "Vanishing lines; portraits with layered bokeh.", "rainFriendly": false, "windSafe": true, "waterfront": false, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "Soft east light, clean air, and lower crowds.", "settings": "1/160\u20131/500 \u2022 f/4\u2013f/8 \u2022 ISO 100\u2013400 for crisp, low\u2011angle light"}, {"id": "2025-10-04-Morning-4-67006", "day": "2025-10-04", "block": "Morning", "rank": 4, "name": "The Ramble (Central Park)", "anchors": [{"label": "Boardwalk bend", "lat": 40.7783, "lon": -73.9715}], "activeAnchor": 0, "bearing": "Woodland pockets", "gear": "24\u201370mm; 50/1.8", "notes": "Boardwalk reflections; winding paths; birds.", "rainFriendly": true, "windSafe": true, "waterfront": false, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "Soft east light, clean air, and lower crowds.", "settings": "1/160\u20131/500 \u2022 f/4\u2013f/8 \u2022 ISO 100\u2013400 for crisp, low\u2011angle light"}, {"id": "2025-10-04-Morning-5-15521", "day": "2025-10-04", "block": "Morning", "rank": 5, "name": "Conservatory Water & \u2018Alice\u2019 Statue", "anchors": [{"label": "SE shore", "lat": 40.7759, "lon": -73.9667}], "activeAnchor": 0, "bearing": "W toward UES skyline", "gear": "24\u201370mm; 50/1.8", "notes": "RC boats; statue details; mirror water in calm air.", "rainFriendly": false, "windSafe": true, "waterfront": false, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "Soft east light, clean air, and lower crowds.", "settings": "1/160\u20131/500 \u2022 f/4\u2013f/8 \u2022 ISO 100\u2013400 for crisp, low\u2011angle light"}, {"id": "2025-10-04-Afternoon-1-6711", "day": "2025-10-04", "block": "Afternoon", "rank": 1, "name": "SoHo \u2014 Greene & Prince", "anchors": [{"label": "Greene & Prince", "lat": 40.7249, "lon": -74.002}], "activeAnchor": 0, "bearing": "N/S street axes", "gear": "35/1.4; 24\u201370mm", "notes": "Cast\u2011iron fa\u00e7ades; cobbles; shadow geometry.", "rainFriendly": false, "windSafe": true, "waterfront": false, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "High, contrasty sun favors interiors & graphic street geometry.", "settings": "Handheld: 1/125\u20131/500 in shade \u2022 Interiors: 1/4\u20131/2\u202fs braced \u2022 ISO 100\u20131600 depending on light"}, {"id": "2025-10-04-Afternoon-2-69452", "day": "2025-10-04", "block": "Afternoon", "rank": 2, "name": "West Village \u2014 Grove & Bedford", "anchors": [{"label": "Grove & Bedford", "lat": 40.7326, "lon": -74.0063}], "activeAnchor": 0, "bearing": "W/E side\u2011streets", "gear": "35/1.4; 50/1.8", "notes": "Brownstone stoops; caf\u00e9 life; signage (crop).", "rainFriendly": false, "windSafe": true, "waterfront": false, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "High, contrasty sun favors interiors & graphic street geometry.", "settings": "Handheld: 1/125\u20131/500 in shade \u2022 Interiors: 1/4\u20131/2\u202fs braced \u2022 ISO 100\u20131600 depending on light"}, {"id": "2025-10-04-Afternoon-3-2955", "day": "2025-10-04", "block": "Afternoon", "rank": 3, "name": "Chinatown \u2014 Doyers St (Bloody Angle)", "anchors": [{"label": "Doyers curve", "lat": 40.7149, "lon": -73.9968}], "activeAnchor": 0, "bearing": "SE curve alley", "gear": "24\u201370mm; 35/1.4", "notes": "Lanterns; scooter pans at 1/15\u20131/25s; typography.", "rainFriendly": true, "windSafe": true, "waterfront": false, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "High, contrasty sun favors interiors & graphic street geometry.", "settings": "Handheld: 1/125\u20131/500 in shade \u2022 Interiors: 1/4\u20131/2\u202fs braced \u2022 ISO 100\u20131600 depending on light"}, {"id": "2025-10-04-Afternoon-4-60232", "day": "2025-10-04", "block": "Afternoon", "rank": 4, "name": "Lower East Side \u2014 Orchard St", "anchors": [{"label": "Orchard mid\u2011block", "lat": 40.7196, "lon": -73.9896}], "activeAnchor": 0, "bearing": "N/S urban canyon", "gear": "24\u201370mm; 50/1.8", "notes": "Tenement fa\u00e7ades; murals; market candids.", "rainFriendly": false, "windSafe": true, "waterfront": false, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "High, contrasty sun favors interiors & graphic street geometry.", "settings": "Handheld: 1/125\u20131/500 in shade \u2022 Interiors: 1/4\u20131/2\u202fs braced \u2022 ISO 100\u20131600 depending on light"}, {"id": "2025-10-04-Afternoon-5-65067", "day": "2025-10-04", "block": "Afternoon", "rank": 5, "name": "Manhattan Bridge Arch & Colonnade (Canal/Bowery)", "anchors": [{"label": "Arch center", "lat": 40.7139, "lon": -73.9967}], "activeAnchor": 0, "bearing": "W toward arch", "gear": "24\u201370mm", "notes": "Classical arch symmetry; taxi/bus streaks.", "rainFriendly": false, "windSafe": true, "waterfront": false, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "High, contrasty sun favors interiors & graphic street geometry.", "settings": "Handheld: 1/125\u20131/500 in shade \u2022 Interiors: 1/4\u20131/2\u202fs braced \u2022 ISO 100\u20131600 depending on light"}, {"id": "2025-10-04-Evening-1-49606", "day": "2025-10-04", "block": "Evening", "rank": 1, "name": "Gantry Plaza State Park (LIC)", "anchors": [{"label": "Gantry boardwalk", "lat": 40.7447, "lon": -73.9576}], "activeAnchor": 0, "bearing": "W to Midtown", "gear": "16\u201324mm; 24\u201370mm; tripod", "notes": "Boardwalk S\u2011curve; skyline pano; check wind.", "rainFriendly": false, "windSafe": false, "waterfront": true, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "Warm side/back light into sunset; blue\u2011hour glow.", "settings": "Golden hour: 1/200\u20131/500 for rim light \u2022 Blue hour: f/8\u2013f/16 \u2022 1\u201315\u202fs on tripod"}, {"id": "2025-10-04-Evening-2-76999", "day": "2025-10-04", "block": "Evening", "rank": 2, "name": "Domino Park (Williamsburg)", "anchors": [{"label": "Catwalk north", "lat": 40.7145, "lon": -73.9672}], "activeAnchor": 0, "bearing": "W/SW to skyline", "gear": "16\u201324mm; 24\u201370mm; CPL", "notes": "Catwalk frames; ferry streaks; bridge tele (crop).", "rainFriendly": false, "windSafe": false, "waterfront": true, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "Warm side/back light into sunset; blue\u2011hour glow.", "settings": "Golden hour: 1/200\u20131/500 for rim light \u2022 Blue hour: f/8\u2013f/16 \u2022 1\u201315\u202fs on tripod"}, {"id": "2025-10-04-Evening-3-85359", "day": "2025-10-04", "block": "Evening", "rank": 3, "name": "Four Freedoms Park (Roosevelt Island tip)", "anchors": [{"label": "Granite point", "lat": 40.7532, "lon": -73.9544}], "activeAnchor": 0, "bearing": "WSW toward Midtown East", "gear": "16\u201324mm; 24\u201370mm; tripod", "notes": "Tree all\u00e9e symmetry; granite minimalism; UN skyline.", "rainFriendly": false, "windSafe": true, "waterfront": true, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "Warm side/back light into sunset; blue\u2011hour glow.", "settings": "Golden hour: 1/200\u20131/500 for rim light \u2022 Blue hour: f/8\u2013f/16 \u2022 1\u201315\u202fs on tripod"}, {"id": "2025-10-04-Evening-4-38185", "day": "2025-10-04", "block": "Evening", "rank": 4, "name": "Battery Park Esplanade", "anchors": [{"label": "Esplanade bend", "lat": 40.7033, "lon": -74.017}], "activeAnchor": 0, "bearing": "SW/W to harbor", "gear": "24\u201370mm; ND", "notes": "Tele Statue of Liberty (70mm + crop); jogger silhouettes; golden water.", "rainFriendly": false, "windSafe": false, "waterfront": true, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "Warm side/back light into sunset; blue\u2011hour glow.", "settings": "Golden hour: 1/200\u20131/500 for rim light \u2022 Blue hour: f/8\u2013f/16 \u2022 1\u201315\u202fs on tripod"}, {"id": "2025-10-04-Evening-5-54242", "day": "2025-10-04", "block": "Evening", "rank": 5, "name": "Hoboken \u2014 Pier A Park", "anchors": [{"label": "Pier A lawn", "lat": 40.7378, "lon": -74.0261}], "activeAnchor": 0, "bearing": "E to Lower Manhattan", "gear": "16\u201324mm; 24\u201370mm; tripod", "notes": "Full skyline pano; path lamps for starbursts at f/16.", "rainFriendly": false, "windSafe": false, "waterfront": true, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "Warm side/back light into sunset; blue\u2011hour glow.", "settings": "Golden hour: 1/200\u20131/500 for rim light \u2022 Blue hour: f/8\u2013f/16 \u2022 1\u201315\u202fs on tripod"}, {"id": "2025-10-04-Night-1-58863", "day": "2025-10-04", "block": "Night", "rank": 1, "name": "Jane\u2019s Carousel (DUMBO)", "anchors": [{"label": "Carousel glass box", "lat": 40.7033, "lon": -73.996}], "activeAnchor": 0, "bearing": "W & N to bridges/skyline", "gear": "24\u201370mm; 16\u201324mm; mini\u2011tripod", "notes": "Carousel glow + long exposure boats.", "rainFriendly": false, "windSafe": false, "waterfront": true, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "Neon, light trails, and reflections\u2014perfect for long exposures.", "settings": "f/8\u2013f/11 \u2022 ISO 100 \u2022 8\u201320\u202fs for trails; or f/1.8\u2013f/2.8 \u2022 ISO 800\u20133200 for handheld portraits"}, {"id": "2025-10-04-Night-2-42195", "day": "2025-10-04", "block": "Night", "rank": 2, "name": "Hunters Point South Park (LIC)", "anchors": [{"label": "South pier", "lat": 40.744, "lon": -73.9581}], "activeAnchor": 0, "bearing": "W/SW to Midtown", "gear": "16\u201324mm; 24\u201370mm; tripod", "notes": "Midtown mirror on calm nights; ferry trails 10\u201330\u202fs.", "rainFriendly": false, "windSafe": false, "waterfront": true, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "Neon, light trails, and reflections\u2014perfect for long exposures.", "settings": "f/8\u2013f/11 \u2022 ISO 100 \u2022 8\u201320\u202fs for trails; or f/1.8\u2013f/2.8 \u2022 ISO 800\u20133200 for handheld portraits"}, {"id": "2025-10-04-Night-3-28501", "day": "2025-10-04", "block": "Night", "rank": 3, "name": "Brooklyn Heights Promenade (night skyline)", "anchors": [{"label": "Center benches", "lat": 40.6968889, "lon": -73.9968889}], "activeAnchor": 0, "bearing": "WSW across East River", "gear": "24\u201370mm; tripod", "notes": "Blue\u2011hour pano; BQE light ribbons below in places.", "rainFriendly": false, "windSafe": false, "waterfront": true, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "Neon, light trails, and reflections\u2014perfect for long exposures.", "settings": "f/8\u2013f/11 \u2022 ISO 100 \u2022 8\u201320\u202fs for trails; or f/1.8\u2013f/2.8 \u2022 ISO 800\u20133200 for handheld portraits"}, {"id": "2025-10-04-Night-4-76563", "day": "2025-10-04", "block": "Night", "rank": 4, "name": "Manhattan Bridge \u2014 Pedestrian Walkway (night)", "anchors": [{"label": "Mid\u2011span south walkway", "lat": 40.7132, "lon": -73.993}], "activeAnchor": 0, "bearing": "SW toward FiDi", "gear": "24\u201370mm; tripod", "notes": "Train streaks; industrial geometry; gritty B&W options.", "rainFriendly": false, "windSafe": false, "waterfront": false, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "Neon, light trails, and reflections\u2014perfect for long exposures.", "settings": "f/8\u2013f/11 \u2022 ISO 100 \u2022 8\u201320\u202fs for trails; or f/1.8\u2013f/2.8 \u2022 ISO 800\u20133200 for handheld portraits"}, {"id": "2025-10-04-Night-5-27529", "day": "2025-10-04", "block": "Night", "rank": 5, "name": "34th St & 6th Ave (Herald Sq \u2014 ESB crosswalk trails)", "anchors": [{"label": "Herald Sq crosswalk", "lat": 40.7496, "lon": -73.987}], "activeAnchor": 0, "bearing": "N/E to ESB", "gear": "24\u201370mm; tripod", "notes": "Crosswalk trails with ESB framed above.", "rainFriendly": false, "windSafe": true, "waterfront": false, "pins": [{"title": "Primary vantage", "detail": "Best\u2011known composition; start here, then refine tangents."}, {"title": "Alternate angle", "detail": "Shift 5\u201320\u202fm to change geometry or avoid obstructions."}, {"title": "Bonus/conditional", "detail": "Use after rain or in crowds; reflections or silhouettes."}], "micro": [{"title": "Primary vantage", "r": 0, "bearing": 0, "dir": "W", "detail": "Start here; anchor frame."}, {"title": "Alternate", "r": 18, "bearing": 45, "dir": "NW", "detail": "Shift a few meters; adjust FG."}, {"title": "Bonus", "r": 22, "bearing": 300, "dir": "SW", "detail": "Use puddles or silhouettes."}], "shots": [{"title": "Wide establishing (16\u201324\u202fmm)", "detail": "Anchor a strong foreground; keep horizon level; mind edges."}, {"title": "Normal view (35\u201350\u202fmm)", "detail": "Layer people for scale; wait for a clean subject path."}, {"title": "Reflection/puddle study", "detail": "Kill CPL to preserve reflections; keep lens axis low/parallel."}, {"title": "Blue\u2011hour long exposure", "detail": "Tripod/clamp; f/8, ISO 100, 2\u201310\u202fs; extend as it darkens."}, {"title": "Portrait/texture (35/50 fast)", "detail": "Shoot at f/1.8\u20132.2 in open shade or neon spill."}], "whyNow": "Neon, light trails, and reflections\u2014perfect for long exposures.", "settings": "f/8\u2013f/11 \u2022 ISO 100 \u2022 8\u201320\u202fs for trails; or f/1.8\u2013f/2.8 \u2022 ISO 800\u20133200 for handheld portraits"}]; // includes anchors[] and micro[] with polar offsets
let TIMES = {};     // computed per selected visit date

// App state
let state = {
  dayMap: { "2025-10-03": "2025-10-03", "2025-10-04": "2025-10-04" }, // selected visit dates
  day: new Set(DAY_KEYS),
  blocks: new Set(["Morning","Afternoon","Evening","Night"]),
  rankMin: 1, rankMax: 5,
  proOnly: false, q: "",
  rain: false, wind: false,
  expandAll: false,
  editMode: false,
  editWhat: "anchor" // or "micro"
};

// Helpers
function degFromCardinal(card){ const m={'N':0,'NNE':22.5,'NE':45,'ENE':67.5,'E':90,'ESE':112.5,'SE':135,'SSE':157.5,'S':180,'SSW':202.5,'SW':225,'WSW':247.5,'W':270,'WNW':292.5,'NW':315,'NNW':337.5}; return m[(card||'N').toUpperCase()] ?? 0; }
function toFixed6(n){ return +n.toFixed(6); }
function metersToLatLon(lat, meters, heading){
  const dlat = (meters * Math.cos(heading*Math.PI/180)) / 111111.0;
  const dlon = (meters * Math.sin(heading*Math.PI/180)) / (111111.0*Math.cos(lat*Math.PI/180));
  return { dlat, dlon };
}
function distBearing(from, to){ // returns {rMeters, bearingDeg}
  const R = 6371000; // m
  const φ1=from[0]*Math.PI/180, φ2=to[0]*Math.PI/180, Δφ=(to[0]-from[0])*Math.PI/180, Δλ=(to[1]-from[1])*Math.PI/180;
  const a = Math.sin(Δφ/2)**2 + Math.cos(φ1)*Math.cos(φ2)*Math.sin(Δλ/2)**2;
  const d = 2*R*Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  const y = Math.sin(Δλ)*Math.cos(φ2);
  const x = Math.cos(φ1)*Math.sin(φ2) - Math.sin(φ1)*Math.cos(φ2)*Math.cos(Δλ);
  let brng = (Math.atan2(y,x)*180/Math.PI + 360) % 360;
  return { r: d, b: brng };
}
function fmtHM(minutes){
  let m = Math.round(minutes); if (m < 0) m+=1440; if (m>=1440) m-=1440;
  const hh = Math.floor(m/60), mm = m%60;
  const ampm = hh>=12 ? "pm":"am";
  const h12 = ((hh+11)%12)+1;
  return `${h12}:${String(mm).padStart(2,'0')} ${ampm}`;
}
function dayLabelISO(iso){
  const d = new Date(iso+"T12:00:00");
  const opts = {weekday:'short', month:'short', day:'numeric', year:'numeric', timeZone:'America/New_York'};
  return new Intl.DateTimeFormat('en-US', opts).format(d).replace(',', ' •');
}
function shortCheckboxLabel(iso){
  const d = new Date(iso+"T12:00:00");
  const o = {month:'2-digit', day:'2-digit', weekday:'short', timeZone:'America/New_York'};
  const s = new Intl.DateTimeFormat('en-US', o).format(d); // e.g., "Fri, 10/03"
  const parts = s.split(', ');
  return `${parts[0]} ${parts[1]}`;
}

// ---------- Solar calculations (NOAA approximate) ----------
function isDST_NY(iso){ // US: second Sunday in March to first Sunday in November
  const y = Number(iso.slice(0,4));
  function nthDow(month, nth, dow){ // 0=Sun
    const d = new Date(Date.UTC(y, month, 1));
    const add = (7 + dow - d.getUTCDay()) % 7;
    const day = 1 + add + 7*(nth-1);
    return new Date(Date.UTC(y, month, day));
  }
  const dstStart = nthDow(2, 2, 0); // March (2), 2nd Sunday
  const dstEnd = nthDow(10, 1, 0); // November (10), 1st Sunday
  const x = new Date(iso+"T12:00:00Z");
  return x >= dstStart && x < dstEnd;
}
function sunTimesNY(iso){
  const lat = NYC.lat * Math.PI/180, lon = NYC.lon;
  const tz = isDST_NY(iso) ? -4 : -5; // hours offset from UTC
  const d = new Date(iso+"T12:00:00Z"); // 12:00 UTC for stability
  // Day of year
  const start = new Date(Date.UTC(d.getUTCFullYear(),0,0));
  const N = Math.floor((d - start)/86400000);
  const gamma = 2*Math.PI/365 * (N - 1 + (12 - 12)/24);
  const E = 229.18*(0.000075 + 0.001868*Math.cos(gamma) - 0.032077*Math.sin(gamma) - 0.014615*Math.cos(2*gamma) - 0.040849*Math.sin(2*gamma));
  const dec = 0.006918 - 0.399912*Math.cos(gamma) + 0.070257*Math.sin(gamma) - 0.006758*Math.cos(2*gamma) + 0.000907*Math.sin(2*gamma) - 0.002697*Math.cos(3*gamma) + 0.00148*Math.sin(3*gamma);
  const solarNoon = 720 - 4*lon - E + tz*60;
  function hourAngle(zenithDeg){
    const Z = zenithDeg*Math.PI/180;
    const cosH = (Math.cos(Z) - Math.sin(lat)*Math.sin(dec)) / (Math.cos(lat)*Math.cos(dec));
    if (cosH < -1 || cosH > 1) return null;
    const H = Math.acos(cosH); return H*180/Math.PI;
  }
  const H0 = hourAngle(90.833);
  const Hcivil = hourAngle(96);
  const sr = solarNoon - 4*(H0||0);
  const ss = solarNoon + 4*(H0||0);
  const cdawn = solarNoon - 4*(Hcivil||0);
  const cdusk = solarNoon + 4*(Hcivil||0);
  return { civil_dawn: fmtHM(cdawn), sunrise: fmtHM(sr), sunset: fmtHM(ss), civil_dusk: fmtHM(cdusk), tzOffset: tz };
}
function moonIllum(iso){
  const syn = 29.530588853;
  const base = Date.parse("2000-01-06T18:14:00Z");
  const t = Date.parse(iso+"T00:00:00Z");
  let age = ((t - base)/86400000) % syn; if (age<0) age += syn;
  const frac = (1 - Math.cos(2*Math.PI*age/syn))/2;
  return Math.round(frac*100);
}

// ---------- Map & editing ----------
let map, cluster, microLayer, editLayer;
let markers = {}; // main markers by loc id
let editMarkers = []; // Draggable markers in edit mode

function initMap(){
  map = L.map('map',{scrollWheelZoom:true}).setView([40.73,-73.98],12);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom: 19, attribution:'&copy; OpenStreetMap'}).addTo(map);
  cluster = L.markerClusterGroup({showCoverageOnHover:false, disableClusteringAtZoom: 15});
  microLayer = L.layerGroup().addTo(map);
  editLayer = L.layerGroup().addTo(map);
  map.addLayer(cluster);
  loadLocalEdits();
  renderMarkers(); fitToVisible();
}

function activeAnchor(loc){ return loc.anchors[loc.activeAnchor || 0]; }
function computeMicroAbs(loc){
  const a = activeAnchor(loc);
  return loc.micro.map(m=>{
    const off = metersToLatLon(a.lat, m.r, m.bearing);
    return { title:m.title, lat: toFixed6(a.lat + off.dlat), lon: toFixed6(a.lon + off.dlon), dir:m.dir, detail:m.detail, r:m.r, bearing:m.bearing };
  });
}

function blockColor(b){ return (b==="Morning")?"#60a5fa":(b==="Afternoon")?"#fbbf24":(b==="Evening")?"#a78bfa":"#fb7185"; }

function renderMarkers(){
  cluster.clearLayers(); markers={}; microLayer.clearLayers(); editLayer.clearLayers();
  visibleLocations().forEach(loc=>{
    const a = activeAnchor(loc);
    const m = L.circleMarker([a.lat,a.lon],{radius:8,weight:2,color:blockColor(loc.block),fillOpacity:.95,fillColor:blockColor(loc.block)});
    m.bindPopup(`<b>${loc.name}</b><br/>${dayLabelISO(state.dayMap[loc.day])} • ${loc.block} • Rank #${loc.rank}<br/><small>${loc.bearing}</small>`);
    cluster.addLayer(m); markers[loc.id]=m;

    const micro = computeMicroAbs(loc);
    micro.forEach(mp=>{
      const mi = L.circleMarker([mp.lat, mp.lon], {radius:4,weight:1,color:'#2dd4bf',fillOpacity:.95,fillColor:'#2dd4bf'}).addTo(microLayer);
      mi.bindPopup(`<b>${loc.name}</b><br/>${mp.title}<br/><a href="https://www.google.com/maps/dir/?api=1&destination=${mp.lat},${mp.lon}&travelmode=walking" target="_blank" rel="noopener">Walk to here</a>`);
      const deg = degFromCardinal(mp.dir);
      const end = offsetMeters([mp.lat,mp.lon], 16, deg);
      L.polyline([[mp.lat,mp.lon], end], {color:'#58a6ff', weight:3, opacity:0.85}).addTo(microLayer);
      const head = arrowHead(end, deg, 5);
      L.polygon(head, {color:'#58a6ff', weight:0, fill:true, fillColor:'#58a6ff', fillOpacity:0.9}).addTo(microLayer);
    });
  });
  if(state.editMode) enterEditMode();
}

function offsetMeters([lat,lon], meters, deg){
  const dlat = (meters * Math.cos(deg*Math.PI/180)) / 111111.0;
  const dlon = (meters * Math.sin(deg*Math.PI/180)) / (111111.0*Math.cos(lat*Math.PI/180));
  return [lat + dlat, lon + dlon];
}
function arrowHead([lat,lon], deg, size){
  const back = offsetMeters([lat,lon], -size, deg);
  const left = offsetMeters(back, size*0.6, deg+90);
  const right= offsetMeters(back, size*0.6, deg-90);
  return [ [lat,lon], left, right ];
}

function fitToVisible(){
  const vis = visibleLocations();
  if (!vis.length) return;
  const bounds = L.latLngBounds(vis.map(l=>{
    const a=activeAnchor(l);
    return [a.lat,a.lon];
  }));
  map.fitBounds(bounds.pad(0.2));
}

function flyTo(id){
  const loc = LOCATIONS.find(l=>l.id===id); if(!loc) return;
  const a=activeAnchor(loc);
  const micro = computeMicroAbs(loc);
  const pts = micro.length ? micro.map(mp=>[mp.lat,mp.lon]).concat([[a.lat,a.lon]]) : [[a.lat,a.lon]];
  const bounds = L.latLngBounds(pts);
  map.fitBounds(bounds.pad(0.3));
}

// ---------- Edit mode ----------
function enterEditMode(){
  editLayer.clearLayers(); editMarkers=[];
  // For each visible location, add draggable anchor (active) and micro pins (if editing micro)
  visibleLocations().forEach(loc=>{
    const a = activeAnchor(loc);
    if(state.editWhat==="anchor"){
      const marker = L.marker([a.lat,a.lon], {draggable:true, title:`Anchor • ${loc.name} — ${a.label}`}).addTo(editLayer);
      marker.on('dragend', e=>{
        const ll = marker.getLatLng();
        a.lat = toFixed6(ll.lat); a.lon = toFixed6(ll.lng);
        saveLocalEdits();
        renderMarkers(); renderList();
      });
      editMarkers.push(marker);
      document.getElementById('editModeWhat').textContent = 'drag the active anchor';
    } else {
      const micro = computeMicroAbs(loc);
      micro.forEach((mp,idx)=>{
        const mk = L.marker([mp.lat,mp.lon], {draggable:true, title:`Micro • ${loc.name} — ${mp.title}`}).addTo(editLayer);
        mk.on('dragend', e=>{
          const ll = mk.getLatLng();
          const vec = distBearing([a.lat,a.lon], [ll.lat, ll.lng]);
          loc.micro[idx].r = Math.max(0, vec.r); loc.micro[idx].bearing = vec.b;
          saveLocalEdits();
          renderMarkers(); renderList();
        });
        editMarkers.push(mk);
      });
      document.getElementById('editModeWhat').textContent = 'drag micro‑pins';
    }
  });
  document.getElementById('editBanner').style.display='block';
}
function exitEditMode(){ editLayer.clearLayers(); editMarkers=[]; document.getElementById('editBanner').style.display='none'; }
function toggleEdit(){ state.editMode=!state.editMode; if(state.editMode) enterEditMode(); else exitEditMode(); }
function setEditWhat(v){ state.editWhat=v; if(state.editMode){ enterEditMode(); } }
function saveLocalEdits(){ localStorage.setItem('nyc_photo_guide_'+DATA_VERSION, JSON.stringify({LOCATIONS, state: {dayMap: state.dayMap}})); }
function loadLocalEdits(){ try{ const s=localStorage.getItem('nyc_photo_guide_'+DATA_VERSION); if(s){ const obj=JSON.parse(s); if(obj.LOCATIONS) LOCATIONS=obj.LOCATIONS; if(obj.state && obj.state.dayMap){ state.dayMap=obj.state.dayMap; } } }catch(e){} }
function resetLocalEdits(){ localStorage.removeItem('nyc_photo_guide_'+DATA_VERSION); location.reload(); }
function exportJSON(){
  const blob = new Blob([JSON.stringify({LOCATIONS, state}, null, 2)], {type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='NYC_Photo_Guide_v6.json'; a.click();
  setTimeout(()=>URL.revokeObjectURL(a.href),3000);
}
function importJSON(file){
  const reader=new FileReader();
  reader.onload=()=>{ try{ const obj=JSON.parse(reader.result); if(obj.LOCATIONS) LOCATIONS=obj.LOCATIONS; if(obj.state && obj.state.dayMap) state.dayMap=obj.state.dayMap; saveLocalEdits(); renderLightPanels(); renderList(); renderMarkers(); }catch(e){ alert('Import failed: invalid JSON'); } };
  reader.readAsText(file);
}

// ---------- Filtering and list ----------
function visibleLocations(){
  return LOCATIONS
    .filter(loc => state.day.has(loc.day) && state.blocks.has(loc.block) && loc.rank>=state.rankMin && loc.rank<=state.rankMax)
    .filter(loc => state.proOnly ? loc.rank<=2 : true)
    .filter(loc => state.rain ? loc.rainFriendly : true)
    .filter(loc => state.wind ? loc.windSafe : true)
    .filter(loc => { if(!state.q) return true; const h=(loc.name+" "+loc.block+" "+loc.bearing+" "+loc.notes+" "+loc.pins.map(p=>p.title).join(" ")).toLowerCase(); return h.includes(state.q.toLowerCase()); })
    .sort((a,b)=> (a.day+b.block+a.rank) < (b.day+b.block+b.rank) ? -1 : 1);
}

function renderList(){
  const list=document.getElementById("list"); list.innerHTML="";
  const grouped = groupBy(visibleLocations(), v=> labelForDay(v.day)+" | "+v.block);
  for(const [key, arr] of grouped){
    const [label, block]=key.split(" | ");
    const sec=document.createElement("section"); sec.className="panel";
    sec.innerHTML=`<div class="section-title">${label} — ${block}</div>`;
    const grid=document.createElement("div"); grid.className="grid";
    arr.sort((a,b)=>a.rank-b.rank).forEach(loc=> grid.appendChild(cardFor(loc)));
    sec.appendChild(grid); list.appendChild(sec);
  }
  renderMarkers();
}

function gmapsOpen(lat,lon){ return `https://www.google.com/maps/search/?api=1&query=${lat},${lon}`; }

function cardFor(loc){
  const a = activeAnchor(loc);
  const card=document.createElement("div"); card.className="card";
  card.innerHTML=`
    <div class="card-header">
      <h3>${loc.name}</h3>
      <div class="badges">
        <span class="badge">Rank #${loc.rank}</span>
        <span class="badge block-${loc.block}">${loc.block}</span>
      </div>
    </div>
    <div class="summary-line">${labelForDay(loc.day)} • <b>${loc.block}</b> • Bearing: ${loc.bearing}</div>
    <div class="kv" style="margin-top:.2rem">
      <div class="k">Why now</div><div>${loc.whyNow}</div>
      <div class="k">Timing</div><div>${timingForBlock(loc.day, loc.block)}</div>
      <div class="k">Face & light</div><div>${loc.bearing}</div>
      <div class="k">Gear</div><div>${loc.gear}</div>
    </div>
    <div class="actions">
      <button onclick="flyTo('${loc.id}')">Show on map</button>
      <a href="${gmapsOpen(a.lat, a.lon)}" target="_blank" rel="noopener">Open (anchor)</a>
      <a href="https://www.google.com/maps/dir/?api=1&destination=${a.lat},${a.lon}&travelmode=walking" target="_blank" rel="noopener">Walk to anchor</a>
    </div>
  `;

  const pset = document.createElement('div'); pset.className='pillset';
  loc.anchors.forEach((an,idx)=>{
    const b=document.createElement('button'); b.className='pill'; b.textContent=an.label + (idx===loc.activeAnchor?' ✓':'');
    b.addEventListener('click', ()=>{ loc.activeAnchor = idx; saveLocalEdits(); renderMarkers(); renderList(); });
    pset.appendChild(b);
  });
  const kvA = document.createElement('div'); kvA.className='kv'; kvA.style.marginTop='.5rem';
  const aTitle=document.createElement('div'); aTitle.className='k'; aTitle.textContent='Anchor';
  const aBox=document.createElement('div'); aBox.appendChild(pset);
  kvA.appendChild(aTitle); kvA.appendChild(aBox);
  card.appendChild(kvA);

  const det=document.createElement("details"); det.className="details"; if(state.expandAll) det.open=true;
  const sum=document.createElement("summary"); sum.textContent="Pins, shots & settings"; det.appendChild(sum);

  const pinsBox=document.createElement('div'); pinsBox.appendChild(makeExpandableList(loc.pins));
  const microAbs = computeMicroAbs(loc);
  const microPills=document.createElement('div'); microPills.className='pillset';
  microAbs.forEach(mp=>{
    const a=document.createElement('a'); a.className='pill'; a.href=`https://www.google.com/maps/dir/?api=1&destination=${mp.lat},${mp.lon}&travelmode=walking`; a.target="_blank"; a.rel="noopener"; a.textContent=mp.title; microPills.appendChild(a);
  });

  const shotsBox=document.createElement('div'); shotsBox.appendChild(makeExpandableList(loc.shots));
  const kv=document.createElement('div'); kv.className='kv'; kv.style.marginTop='.5rem';
  kv.appendChild(titleCell('Pins')); kv.appendChild(pinsBox);
  kv.appendChild(titleCell('Micro‑pins')); kv.appendChild(microPills);
  kv.appendChild(titleCell('Settings')); kv.appendChild(textCell(loc.settings));
  kv.appendChild(titleCell('Plan B')); kv.appendChild(textCell("Switch anchor or alternate micro‑pin; safety > shot."));
  kv.appendChild(titleCell('Transit')); kv.appendChild(textCell("Subway nearby; check MTA changes."));
  det.appendChild(kv); card.appendChild(det);
  return card;
}
function titleCell(s){ const d=document.createElement('div'); d.className='k'; d.textContent=s; return d; }
function textCell(s){ const d=document.createElement('div'); d.textContent=s; return d; }

function makeExpandableList(items){
  const ul=document.createElement('ul'); ul.className='expand-list';
  items.forEach(it=>{
    const li=document.createElement('li'); li.className='expand-item';
    const btn=document.createElement('button'); btn.className='expand-summary'; btn.innerHTML=`<span>${it.title}</span> <span class="hint">Tap for details</span>`;
    const body=document.createElement('div'); body.className='expand-body'; body.textContent=it.detail;
    btn.addEventListener('click', ()=> li.classList.toggle('open'));
    li.appendChild(btn); li.appendChild(body); ul.appendChild(li);
  });
  return ul;
}
function groupBy(list, keyFn){ const m=new Map(); list.forEach(it=>{ const k=keyFn(it); if(!m.has(k)) m.set(k,[]); m.get(k).push(it); }); return m; }

// ---------- Light panels & date picker ----------
function labelForDay(dayKey){ return dayLabelISO(state.dayMap[dayKey]); }
function timingForBlock(dayKey, block){
  const t = TIMES[dayKey];
  if(!t) return "";
  if(block==="Morning") return `Arrive 6:00–7:30 am • Civil dawn ${t.civil_dawn} • Sunrise ${t.sunrise}`;
  if(block==="Afternoon") return `Best 12:00–3:30 pm • Use shade/interiors for soft contrast`;
  if(block==="Evening") return `Arrive 5:30–7:00 pm • Sunset ${t.sunset} • Civil dusk ${t.civil_dusk}`;
  if(block==="Night") return `Start 6:50–9:00 pm • Civil dusk ${t.civil_dusk} • Moon ${t.moonText}`;
  return "";
}

function computeTimes(){
  TIMES={};
  DAY_KEYS.forEach(k=>{
    const iso = state.dayMap[k];
    const sun = sunTimesNY(iso);
    const moonPct = moonIllum(iso);
    const moonText = `${moonPct}%% illum`;
    TIMES[k] = { ...sun, moonText, label: dayLabelISO(iso), iso };
  });
  document.querySelector('label[for="day1"]').childNodes[1].nodeValue = " " + shortCheckboxLabel(state.dayMap["2025-10-03"]);
  document.querySelector('label[for="day2"]').childNodes[1].nodeValue = " " + shortCheckboxLabel(state.dayMap["2025-10-04"]);
}

function renderLightPanels(){
  computeTimes();
  const el=document.getElementById("lightpanels"); el.innerHTML="";
  DAY_KEYS.forEach((k, idx)=>{
    const t=TIMES[k], iso=state.dayMap[k];
    const p=document.createElement("div"); p.className="panel";
    const ymd = iso.replace(/-/g,"");
    const noaa = `https://tidesandcurrents.noaa.gov/noaatidepredictions.html?id=8518750&bdate=${ymd}&edate=${ymd}&units=standard&timeZone=lst_ldt&datum=MLLW&interval=hilo`;
    const moon = `https://www.timeanddate.com/moon/usa/new-york?month=${Number(iso.slice(5,7))}&year=${iso.slice(0,4)}`;
    p.innerHTML=`<div class="section-title">${t.label} — Light • Moon • Tides</div>
      <div class="kv">
        <div class="k">Civil dawn</div><div>${t.civil_dawn}</div>
        <div class="k">Sunrise</div><div>${t.sunrise}</div>
        <div class="k">Sunset</div><div>${t.sunset}</div>
        <div class="k">Civil dusk</div><div>${t.civil_dusk}</div>
        <div class="k">Moon</div><div>${t.moonText} • <a href="${moon}" target="_blank" rel="noopener">Details</a></div>
        <div class="k">Tides (The Battery)</div><div><a href="${noaa}" target="_blank" rel="noopener">Open NOAA high/low</a></div>
      </div>`;
    el.appendChild(p);
  });
}

// ---------- Header UI ----------
function initUI(){
  document.getElementById("dateA").value = state.dayMap["2025-10-03"];
  document.getElementById("dateB").value = state.dayMap["2025-10-04"];
  document.getElementById("dateA").addEventListener('change', e=>{ state.dayMap["2025-10-03"]=e.target.value; saveLocalEdits(); renderLightPanels(); renderList(); renderMarkers(); });
  document.getElementById("dateB").addEventListener('change', e=>{ state.dayMap["2025-10-04"]=e.target.value; saveLocalEdits(); renderLightPanels(); renderList(); renderMarkers(); });

  document.querySelectorAll('input[name="day"]').forEach(cb=>cb.addEventListener('change', e=>{ const v=e.target.value; if(e.target.checked) state.day.add(v); else state.day.delete(v); renderList(); renderMarkers(); fitToVisible(); }));
  document.querySelectorAll('input[name="block"]').forEach(cb=>cb.addEventListener('change', e=>{ const v=e.target.value; if(e.target.checked) state.blocks.add(v); else state.blocks.delete(v); renderList(); renderMarkers(); fitToVisible(); }));
  const rmin=document.getElementById("rankMin"), rmax=document.getElementById("rankMax");
  [rmin,rmax].forEach(el=> el.addEventListener('input', ()=>{ state.rankMin=+rmin.value; state.rankMax=+rmax.value; if(state.rankMin>state.rankMax) state.rankMin=state.rankMax; document.getElementById("rankLabel").textContent=`#${state.rankMin}–#${state.rankMax}`; renderList(); renderMarkers(); fitToVisible(); }));
  document.getElementById("proOnly").addEventListener('change', e=>{ state.proOnly=e.target.checked; renderList(); renderMarkers(); fitToVisible(); });
  document.getElementById("q").addEventListener('input', e=>{ state.q=e.target.value; renderList(); renderMarkers(); fitToVisible(); });
  document.getElementById("rain").addEventListener('change', e=>{ state.rain=e.target.checked; renderList(); renderMarkers(); fitToVisible(); });
  document.getElementById("wind").addEventListener('change', e=>{ state.wind=e.target.checked; renderList(); renderMarkers(); fitToVisible(); });

  document.getElementById("clear").addEventListener('click', ()=>{
    state={...state, day:new Set(DAY_KEYS), blocks:new Set(["Morning","Afternoon","Evening","Night"]), rankMin:1, rankMax:5, proOnly:false, q:"", rain:false, wind:false};
    document.querySelectorAll('input[name="day"]').forEach(cb=>cb.checked=true);
    document.querySelectorAll('input[name="block"]').forEach(cb=>cb.checked=true);
    rmin.value=1; rmax.value=5; document.getElementById("rankLabel").textContent="#1–#5";
    document.getElementById("proOnly").checked=false; document.getElementById("q").value=""; document.getElementById("rain").checked=false; document.getElementById("wind").checked=false;
    renderList(); renderMarkers(); fitToVisible();
  });
  document.getElementById("expandAll").addEventListener('click', ()=>{ state.expandAll=true; renderList(); });
  document.getElementById("collapseAll").addEventListener('click', ()=>{ state.expandAll=false; renderList(); });
  document.getElementById("exportCSV").addEventListener('click', exportCSV);
  document.getElementById("exportKML").addEventListener('click', exportKML);
  document.getElementById("print").addEventListener('click', ()=>window.print());
  document.getElementById("theme").addEventListener('click', ()=>toggleTheme());
  document.getElementById("editMode").addEventListener('click', toggleEdit);
  document.getElementById("editA").addEventListener('click', ()=>setEditWhat('anchor'));
  document.getElementById("editM").addEventListener('click', ()=>setEditWhat('micro'));
  document.getElementById("savePins").addEventListener('click', saveLocalEdits);
  document.getElementById("resetPins").addEventListener('click', resetLocalEdits);
  document.getElementById("exportJSON").addEventListener('click', exportJSON);
  document.getElementById("importJSON").addEventListener('change', e=>{ if(e.target.files[0]) importJSON(e.target.files[0]); });
  renderLightPanels();
}

// ---------- Export helpers ----------
function exportCSV(){
  const rows = [["dayLabel","block","rank","name","activeAnchorLabel","anchorLat","anchorLon"]];
  visibleLocations().forEach(l=>{
    const a=activeAnchor(l);
    rows.push([labelForDay(l.day), l.block, l.rank, l.name, a.label, a.lat, a.lon]);
  });
  const csv = rows.map(r=>r.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(",")).join("\n");
  const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([csv],{type:'text/plain'})); a.download="NYC_Photo_Guide_Anchors_Filtered.csv"; a.click();
}
function exportKML(){
  let kml = `<?xml version="1.0" encoding="UTF-8"?>\n<kml xmlns="http://www.opengis.net/kml/2.2"><Document><name>NYC Photo Pins (Anchors+Micro)</name>`;
  visibleLocations().forEach(p=>{
    const a=activeAnchor(p);
    const desc = `${labelForDay(p.day)} • ${p.block} • Rank ${p.rank}<br/>${p.bearing}`;
    kml += `<Placemark><name>${escapeXML(p.name+" — "+a.label)}</name><description><![CDATA[${desc}]]></description><Point><coordinates>${a.lon},${a.lat},0</coordinates></Point></Placemark>`;
    computeMicroAbs(p).forEach(mp=>{
      const d2 = `${p.name} / ${mp.title}<br/>Dir: ${mp.dir}`;
      kml += `<Placemark><name>${escapeXML(p.name+" — "+mp.title)}</name><description><![CDATA[${d2}]]></description><Point><coordinates>${mp.lon},${mp.lat},0</coordinates></Point></Placemark>`;
    });
  });
  kml += `</Document></kml>`;
  const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([kml],{type:'text/plain'})); a.download="NYC_Photo_Pins_Filtered.kml"; a.click();
}
function escapeXML(s){ return String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"); }

// ---------- Theme ----------
function toggleTheme(){
  const root=document.documentElement;
  const dark=getComputedStyle(root).getPropertyValue('--bg').trim()==='#0b1220';
  if(dark){
    root.style.setProperty('--bg','#f6f8fb'); root.style.setProperty('--panel','#ffffff'); root.style.setProperty('--card','#ffffff'); root.style.setProperty('--text','#0b1220');
    root.style.setProperty('--muted','#465a77'); root.style.setProperty('--border','#d7e1ef'); root.style.setProperty('--shadow','rgba(0,0,0,.07)');
  }else{
    root.style.setProperty('--bg','#0b1220'); root.style.setProperty('--panel','#0f172a'); root.style.setProperty('--card','#0e1426'); root.style.setProperty('--text','#e6edf6');
    root.style.setProperty('--muted','#9bb0c9'); root.style.setProperty('--border','#1f2a44'); root.style.setProperty('--shadow','rgba(0,0,0,.35)');
  }
}

// ---------- Init ----------
window.addEventListener('DOMContentLoaded', ()=>{
  initMap();
  initUI();
  renderList();
});


</script>
</body>
</html>
