<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NYC Photo Guide — v8.5 (Hybrid)</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
:root{
  --bg:#0b1220; --panel:#0f172a; --card:#0e1426; --text:#e6edf6; --muted:#9bb0c9;
  --border:#1f2a44; --shadow: rgba(0,0,0,.35);
  --blue:#60a5fa; --amber:#fbbf24; --violet:#a78bfa; --rose:#fb7185; --teal:#2dd4bf; --green:#34d399;
}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;background:var(--bg);color:var(--text)}
header{position:sticky;top:0;z-index:40;background:linear-gradient(90deg,#0b1220,#10203c);
  border-bottom:1px solid var(--border);box-shadow:0 6px 20px var(--shadow)}
.header{max-width:1280px;margin:0 auto;padding:.7rem .9rem;display:flex;gap:.6rem;flex-wrap:wrap;align-items:center}
h1{margin:0 1rem 0 0;font-size:1.06rem;font-weight:800}
.controls{display:flex;gap:.45rem;flex-wrap:wrap;align-items:center}
.controls .chip, .controls button, .controls input, .controls label{background:#0a1326;border:1px solid var(--border);color:var(--text);border-radius:.55rem;padding:.45rem .6rem}
.controls input[type="date"], .controls input[type="search"]{padding:.4rem .55rem}
main{max-width:1280px;margin:0 auto;display:grid;grid-template-columns:minmax(360px,560px) 1fr;gap:1rem;padding:1rem}
@media(max-width:1000px){main{grid-template-columns:1fr} .mapWrap{position:static;height:360px}}
.panel{background:var(--panel);border:1px solid var(--border);border-radius:1rem;padding:1rem}
.grid{display:grid;gap:.9rem}
.card{background:var(--card);border:1px solid var(--border);border-radius:1rem;padding:.9rem;margin:.7rem 0;box-shadow:0 6px 18px rgba(0,0,0,.35)}
.card h3{margin:.1rem 0 .4rem 0;font-size:1.03rem}
.badge{display:inline-block;margin-left:.4rem;border:1px solid var(--border);padding:.15rem .4rem;border-radius:.4rem}
.badge.Morning{background:#0b203a;color:#a5e3ff} .badge.Afternoon{background:#2a1a00;color:#ffd08a}
.badge.Evening{background:#1a1025;color:#e5d5ff} .badge.Night{background:#1e0c12;color:#ffc1c9}
.kv{display:grid;grid-template-columns:140px 1fr;gap:.35rem .6rem}
.k{color:var(--muted);font-weight:600}
.pillset{display:flex;gap:.4rem;flex-wrap:wrap}
.pill{border:1px solid var(--border);padding:.25rem .5rem;border-radius:999px;background:#0b1326;color:#cfe1ff}
.mapWrap{position:sticky;top:130px;height:calc(100vh - 160px)}
#gmap,#leaflet{height:100%;border:1px solid var(--border);border-radius:1rem}
.modeTabs{display:flex;gap:.4rem;margin-bottom:.6rem}
.modeTabs button{background:#0b1326;border:1px solid var(--border);color:#cfe1ff;border-radius:.5rem;padding:.35rem .55rem}
.modeTabs button.active{outline:2px solid #60a5fa}
.ref-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:.5rem}
.ref-grid img{width:100%;height:100px;object-fit:cover;border-radius:.35rem;border:1px solid #24324d}
small.muted{color:var(--muted)}
</style>
</head>
<body>
<header>
  <div class="header">
    <h1>NYC Photo Guide — v8.5 (Hybrid)</h1>
    <div class="controls">
      <span class="chip">Visit days (NYC):</span>
      <label class="chip" for="dateA">Day A</label><input id="dateA" type="date" value="2025-10-03"/>
      <label class="chip" for="dateB">Day B</label><input id="dateB" type="date" value="2025-10-04"/>
      <label class="chip"><input type="checkbox" name="day" value="2025-10-03" checked/> Fri 10/03</label>
      <label class="chip"><input type="checkbox" name="day" value="2025-10-04" checked/> Sat 10/04</label>
      <span class="chip">Blocks:</span>
      <label class="chip"><input type="checkbox" name="block" value="Morning" checked/> Morning</label>
      <label class="chip"><input type="checkbox" name="block" value="Afternoon" checked/> Afternoon</label>
      <label class="chip"><input type="checkbox" name="block" value="Evening" checked/> Evening</label>
      <label class="chip"><input type="checkbox" name="block" value="Night" checked/> Night</label>
      <span class="chip">Rank <span id="rankLabel">#1–#5</span></span>
      <input id="rankMin" type="range" min="1" max="5" value="1"/>
      <input id="rankMax" type="range" min="1" max="5" value="5"/>
      <label class="chip"><input type="checkbox" id="proOnly"/> Pro only (#1–#2)</label>
      <label class="chip"><input type="checkbox" id="rain"/> Rain plan</label>
      <label class="chip"><input type="checkbox" id="wind"/> Wind‑safe</label>
      <label class="chip" for="q">Search</label><input id="q" type="search" placeholder="Search…"/>
      <button id="expandAll">Expand all</button>
      <button id="collapseAll">Collapse all</button>
      <button id="exportCSV">Export CSV</button>
      <button id="exportKML">Export KML</button>
      <button id="print">Print</button>
      <button id="theme">Theme</button>
      <button id="exportJSON">Export JSON</button>
      <label class="chip">Import <input type="file" id="importJSON" accept="application/json"/></label>
    </div>
  </div>
</header>

<main>
  <div class="panel">
    <div class="modeTabs">
      <button id="modeGoogle" title="Use Google Maps with Places, Street View, ETA, directions">Google Maps (online)</button>
      <button id="modeLeaflet" title="Use Leaflet/OSM offline fallback">Leaflet (offline)</button>
    </div>
    <div id="lightpanels" class="grid"></div>
  </div>

  <section class="panel">
    <b>Rules & Reminders</b>
    <ul>
      <li>Observation decks often restrict <b>tripods</b>. Shoot handheld or with a mini support.</li>
      <li>Grand Central / NYPL / Oculus interior: casual photos ok; professional rigs/tripods may <b>require permits</b>.</li>
      <li>Subways: photography permitted without lights/reflectors/tripods; stay behind safety lines.</li>
      <li>Waterfront long exposures: check <b>NOAA “The Battery” tides</b> and wind.</li>
    </ul>
  </section>

  <div id="list" class="grid"></div>

  <div class="mapWrap">
    <div id="gmap" class="panel" style="display:none"></div>
    <div id="leaflet" class="panel" style="display:none"></div>
  </div>
</main>

<footer class="panel" style="max-width:1280px;margin:1rem auto">v8 • Google Maps + Places, reverse geocode, ETA/route, NOAA tides, micro‑pin arrows aligned to subject, edit anchors with micro‑pin offsets following, Leaflet offline fallback.</footer>

<script>
(function(){
  const PI=Math.PI, rad=PI/180;
  function toJulian(date){return date/86400000-0.5+2440588;}
  function fromJulian(j){return new Date((j+0.5-2440588)*86400000);}
  function toDays(date){return toJulian(date)-2451545;}
  const e=rad*23.4397;
  function RA(l,b){return Math.atan2(Math.sin(l)*Math.cos(e)-Math.tan(b)*Math.sin(e),Math.cos(l));}
  function DEC(l,b){return Math.asin(Math.sin(b)*Math.cos(e)+Math.cos(b)*Math.sin(e)*Math.sin(l));}
  function siderealTime(d,lw){return rad*(280.16+360.9856235*d)-lw;}
  function solarMeanAnomaly(d){return rad*(357.5291+0.98560028*d);}
  function eclipticLongitude(M){const C=rad*(1.9148*Math.sin(M)+0.02*Math.sin(2*M)+0.0003*Math.sin(3*M));const P=rad*102.9372;return M+C+P+PI;}
  function sunCoords(d){const M=solarMeanAnomaly(d),L=eclipticLongitude(M);return {dec:DEC(L,0),ra:RA(L,0)};}
  function julianCycle(d,lw){return Math.round(d-0.0009-lw/(2*PI));}
  function approxTransit(Ht,lw,n){return 0.0009+(Ht+lw)/(2*PI)+n;}
  function solarTransitJ(ds,M,L){return 2451545+ds+0.0053*Math.sin(M)-0.0069*Math.sin(2*L);}
  function hourAngle(h,phi,d){return Math.acos((Math.sin(h)-Math.sin(phi)*Math.sin(d))/(Math.cos(phi)*Math.cos(d)));}
  function getSetJ(h,lw,phi,dec,n,M,L){const w=hourAngle(h,phi,dec),a=approxTransit(w,lw,n);return solarTransitJ(a,M,L);}
  window.SunX={
    sunTimes:function(date,lat,lng){
      const lw=rad*-lng,phi=rad*lat,d=toDays(date),n=julianCycle(d,lw),ds=approxTransit(0,lw,n),M=solarMeanAnomaly(d),L=eclipticLongitude(M),dec=DEC(L,0);
      const Jnoon=solarTransitJ(ds,M,L),h0=(-0.833)*rad,Jset=getSetJ(h0,lw,phi,dec,n,M,L),Jrise=Jnoon-(Jset-Jnoon),hc=(-6)*rad,Jcset=getSetJ(hc,lw,phi,dec,n,M,L),Jcrise=Jnoon-(Jcset-Jnoon);
      return {sunrise:fromJulian(Jrise),sunset:fromJulian(Jset),dawn:fromJulian(Jcrise),dusk:fromJulian(Jcset)};
    },
    moonTimes:function(date,lat,lng){
      function mC(d){const L=rad*(218.316+13.176396*d),M=rad*(134.963+13.064993*d),F=rad*(93.272+13.229350*d);let l=L+rad*6.289*Math.sin(M),b=rad*5.128*Math.sin(F);return {ra:RA(l,b),dec:DEC(l,b)};}
      const lw=-lng*rad,phi=lat*rad,d=toDays(new Date(date.setHours(0,0,0,0)))-0.5-lng/360;
      function alt(t){const m=mC(t),H=siderealTime(t,lw)-m.ra;return Math.asin(Math.sin(phi)*Math.sin(m.dec)+Math.cos(phi)*Math.cos(m.dec)*Math.cos(H))-0.017;}
      const h1=alt(d-1),h2=alt(d),h3=alt(d+1),a=(h1+h3)/2-h2,b=(h3-h1)/2,hc=0.133*rad; let rise=null,set=null; const disc=b*b-4*a*(h2-hc);
      if(disc>=0){const dxe=Math.sqrt(disc); const x1=(-b-dxe)/(2*a),x2=(-b+dxe)/(2*a); if(x1>-1&&x1<1) rise=fromJulian(2451545+d+x1); if(x2>-1&&x2<1) set=fromJulian(2451545+d+x2);}
      return {rise,set,illum:.5};
    }
  };
})();
</script>
<script>

const CFG={apiKey:'AIzaSyDsq2ztFeFfmgqiRIZZtK5R7aCVGF66-80',nyc:{lat:40.7128,lon:-74.0060},store:'nyc_photo_guide_v8'};
let LOCATIONS=[{"id": "dumbo_washington_water_manhattan_bridge_keyhole", "name": "DUMBO — Washington & Water (Manhattan Bridge Keyhole)", "day": "2025-10-03", "block": "Morning", "rank": 1, "bearing": "NNE toward Manhattan Bridge/ESB", "whyNow": "Arrive pre‑dawn; classic ESB-in-arch alignment.", "gear": "24–70mm; CPL/ND", "settings": "Arrive 30–60 min before sunrise; handheld 1/250s+ @ f/5.6–8, ISO 100–400.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7034225, "lon": -73.9893714}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 22.5, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 22.5, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 22.5, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Parking gap watch", "detail": "Scan for a temporary gap to remove parked cars; be ready to shoot quickly."}, {"title": "Reflections after wash", "detail": "Street or lawn irrigation leaves sheen—use CPL to control glare."}, {"title": "Taxi or jogger streaks", "detail": "If traffic begins, try 1/8–1/2s for motion streaks."}], "shots": [{"title": "Establishing wide (16–24mm)", "detail": "Include context and sky color; keep verticals straight."}, {"title": "Low angle leading lines", "detail": "Camera close to ground; emphasize texture or rails."}, {"title": "Human scale", "detail": "Single figure walking/running; time the stride."}, {"title": "Compressed crop (50/70mm)", "detail": "Use longer end for a clean graphic frame; crop if needed."}, {"title": "Detail cutaway", "detail": "Reflections, signage, patterns that summarize place."}]}, {"id": "pebble_beach_empire_fulton_ferry", "name": "Pebble Beach / Empire–Fulton Ferry", "day": "2025-10-03", "block": "Morning", "rank": 2, "bearing": "WSW toward Lower Manhattan", "whyNow": "Rising tide likely; long exposures for water smoothing.", "gear": "16–24mm; 3–6‑stop ND; tripod", "settings": "Arrive 30–60 min before sunrise; handheld 1/250s+ @ f/5.6–8, ISO 100–400.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7041667, "lon": -73.9922222}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 247.5, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 247.5, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 247.5, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Parking gap watch", "detail": "Scan for a temporary gap to remove parked cars; be ready to shoot quickly."}, {"title": "Reflections after wash", "detail": "Street or lawn irrigation leaves sheen—use CPL to control glare."}, {"title": "Taxi or jogger streaks", "detail": "If traffic begins, try 1/8–1/2s for motion streaks."}], "shots": [{"title": "Establishing wide (16–24mm)", "detail": "Include context and sky color; keep verticals straight."}, {"title": "Low angle leading lines", "detail": "Camera close to ground; emphasize texture or rails."}, {"title": "Human scale", "detail": "Single figure walking/running; time the stride."}, {"title": "Compressed crop (50/70mm)", "detail": "Use longer end for a clean graphic frame; crop if needed."}, {"title": "Detail cutaway", "detail": "Reflections, signage, patterns that summarize place."}]}, {"id": "brooklyn_heights_promenade", "name": "Brooklyn Heights Promenade", "day": "2025-10-03", "block": "Morning", "rank": 3, "bearing": "WSW across East River", "whyNow": "Tele compression of skyline; benches and trees for layers.", "gear": "24–70mm (at 70mm) or 50mm (crop); 24–70mm", "settings": "Arrive 30–60 min before sunrise; handheld 1/250s+ @ f/5.6–8, ISO 100–400.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.6969, "lon": -73.9969}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 247.5, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 247.5, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 247.5, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Parking gap watch", "detail": "Scan for a temporary gap to remove parked cars; be ready to shoot quickly."}, {"title": "Reflections after wash", "detail": "Street or lawn irrigation leaves sheen—use CPL to control glare."}, {"title": "Taxi or jogger streaks", "detail": "If traffic begins, try 1/8–1/2s for motion streaks."}], "shots": [{"title": "Establishing wide (16–24mm)", "detail": "Include context and sky color; keep verticals straight."}, {"title": "Low angle leading lines", "detail": "Camera close to ground; emphasize texture or rails."}, {"title": "Human scale", "detail": "Single figure walking/running; time the stride."}, {"title": "Compressed crop (50/70mm)", "detail": "Use longer end for a clean graphic frame; crop if needed."}, {"title": "Detail cutaway", "detail": "Reflections, signage, patterns that summarize place."}]}, {"id": "manhattan_bridge_pedestrian_walkway_south", "name": "Manhattan Bridge — Pedestrian Walkway (south)", "day": "2025-10-03", "block": "Morning", "rank": 4, "bearing": "SW toward Financial District", "whyNow": "Train streaks + skyline through fencing patterns.", "gear": "24–70mm; mini‑tripod", "settings": "Arrive 30–60 min before sunrise; handheld 1/250s+ @ f/5.6–8, ISO 100–400.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7132, "lon": -73.993}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 225, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 225, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 225, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Parking gap watch", "detail": "Scan for a temporary gap to remove parked cars; be ready to shoot quickly."}, {"title": "Reflections after wash", "detail": "Street or lawn irrigation leaves sheen—use CPL to control glare."}, {"title": "Taxi or jogger streaks", "detail": "If traffic begins, try 1/8–1/2s for motion streaks."}], "shots": [{"title": "Establishing wide (16–24mm)", "detail": "Include context and sky color; keep verticals straight."}, {"title": "Low angle leading lines", "detail": "Camera close to ground; emphasize texture or rails."}, {"title": "Human scale", "detail": "Single figure walking/running; time the stride."}, {"title": "Compressed crop (50/70mm)", "detail": "Use longer end for a clean graphic frame; crop if needed."}, {"title": "Detail cutaway", "detail": "Reflections, signage, patterns that summarize place."}]}, {"id": "brooklyn_bridge_walkway_center_spans", "name": "Brooklyn Bridge — Walkway (center spans)", "day": "2025-10-03", "block": "Morning", "rank": 5, "bearing": "WNW toward Lower Manhattan", "whyNow": "Cable symmetry; low angle wood planks foreground.", "gear": "16–24mm; clamp", "settings": "Arrive 30–60 min before sunrise; handheld 1/250s+ @ f/5.6–8, ISO 100–400.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7067, "lon": -73.9967}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 292.5, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 292.5, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 292.5, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Parking gap watch", "detail": "Scan for a temporary gap to remove parked cars; be ready to shoot quickly."}, {"title": "Reflections after wash", "detail": "Street or lawn irrigation leaves sheen—use CPL to control glare."}, {"title": "Taxi or jogger streaks", "detail": "If traffic begins, try 1/8–1/2s for motion streaks."}], "shots": [{"title": "Establishing wide (16–24mm)", "detail": "Include context and sky color; keep verticals straight."}, {"title": "Low angle leading lines", "detail": "Camera close to ground; emphasize texture or rails."}, {"title": "Human scale", "detail": "Single figure walking/running; time the stride."}, {"title": "Compressed crop (50/70mm)", "detail": "Use longer end for a clean graphic frame; crop if needed."}, {"title": "Detail cutaway", "detail": "Reflections, signage, patterns that summarize place."}]}, {"id": "grand_central_terminal_main_concourse", "name": "Grand Central Terminal — Main Concourse", "day": "2025-10-03", "block": "Afternoon", "rank": 1, "bearing": "Interior (multi)", "whyNow": "Motion blur at 1/4–1/2s; tripods require permit.", "gear": "16–24mm; fast 35/50mm", "settings": "Work shade and geometry; CPL for glare; 1/250s+ @ f/5.6–8.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.75278, "lon": -73.97722}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 0.0, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 0.0, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 0.0, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Shadow geometry", "detail": "Look for repeating cast-iron, stoops, or rails to form patterns."}, {"title": "Street portrait moment", "detail": "Use 35/50mm for environmental portraits; ask politely."}, {"title": "Compression detail", "detail": "Use the 70mm end of 24–70; crop if needed for stronger layers."}], "shots": [{"title": "Shadow lattice (24–70mm)", "detail": "Catch window/railing shadows making a grid or stripes."}, {"title": "Corner portrait (35/50mm)", "detail": "Subject on edge of light; background in soft shade."}, {"title": "Texture macro (50mm)", "detail": "Look for worn stone/metal details; low ISO, high f‑stop."}, {"title": "Layered street (70mm)", "detail": "Stack elements; shoot through foreground."}, {"title": "Signage type", "detail": "Tight crop of iconic typography or tile work."}]}, {"id": "nypl_main_branch_stephen_a_schwarzman", "name": "NYPL Main Branch (Stephen A. Schwarzman)", "day": "2025-10-03", "block": "Afternoon", "rank": 2, "bearing": "E/W façades; interior symmetry", "whyNow": "No flash/tripods inside; quiet portraits on steps.", "gear": "24–70mm; fast 35mm", "settings": "Work shade and geometry; CPL for glare; 1/250s+ @ f/5.6–8.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7532, "lon": -73.9822}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 90, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 90, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 90, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Shadow geometry", "detail": "Look for repeating cast-iron, stoops, or rails to form patterns."}, {"title": "Street portrait moment", "detail": "Use 35/50mm for environmental portraits; ask politely."}, {"title": "Compression detail", "detail": "Use the 70mm end of 24–70; crop if needed for stronger layers."}], "shots": [{"title": "Shadow lattice (24–70mm)", "detail": "Catch window/railing shadows making a grid or stripes."}, {"title": "Corner portrait (35/50mm)", "detail": "Subject on edge of light; background in soft shade."}, {"title": "Texture macro (50mm)", "detail": "Look for worn stone/metal details; low ISO, high f‑stop."}, {"title": "Layered street (70mm)", "detail": "Stack elements; shoot through foreground."}, {"title": "Signage type", "detail": "Tight crop of iconic typography or tile work."}]}, {"id": "flatiron_district_23rd_broadway", "name": "Flatiron District (23rd & Broadway)", "day": "2025-10-03", "block": "Afternoon", "rank": 3, "bearing": "NNE along 5th Ave", "whyNow": "Median for wedge composition; daytime streaks with ND.", "gear": "24–70mm; 24–70mm (at 70mm) or 50mm (crop); ND", "settings": "Work shade and geometry; CPL for glare; 1/250s+ @ f/5.6–8.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7411, "lon": -73.9897}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 22.5, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 22.5, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 22.5, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Shadow geometry", "detail": "Look for repeating cast-iron, stoops, or rails to form patterns."}, {"title": "Street portrait moment", "detail": "Use 35/50mm for environmental portraits; ask politely."}, {"title": "Compression detail", "detail": "Use the 70mm end of 24–70; crop if needed for stronger layers."}], "shots": [{"title": "Shadow lattice (24–70mm)", "detail": "Catch window/railing shadows making a grid or stripes."}, {"title": "Corner portrait (35/50mm)", "detail": "Subject on edge of light; background in soft shade."}, {"title": "Texture macro (50mm)", "detail": "Look for worn stone/metal details; low ISO, high f‑stop."}, {"title": "Layered street (70mm)", "detail": "Stack elements; shoot through foreground."}, {"title": "Signage type", "detail": "Tight crop of iconic typography or tile work."}]}, {"id": "the_oculus_wtc_plaza", "name": "The Oculus & WTC Plaza", "day": "2025-10-03", "block": "Afternoon", "rank": 4, "bearing": "Interior/exterior ribs", "whyNow": "Symmetry studies; security may restrict tripods inside.", "gear": "16–24mm; 24–70mm", "settings": "Work shade and geometry; CPL for glare; 1/250s+ @ f/5.6–8.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7126, "lon": -74.0098}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 0.0, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 0.0, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 0.0, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Shadow geometry", "detail": "Look for repeating cast-iron, stoops, or rails to form patterns."}, {"title": "Street portrait moment", "detail": "Use 35/50mm for environmental portraits; ask politely."}, {"title": "Compression detail", "detail": "Use the 70mm end of 24–70; crop if needed for stronger layers."}], "shots": [{"title": "Shadow lattice (24–70mm)", "detail": "Catch window/railing shadows making a grid or stripes."}, {"title": "Corner portrait (35/50mm)", "detail": "Subject on edge of light; background in soft shade."}, {"title": "Texture macro (50mm)", "detail": "Look for worn stone/metal details; low ISO, high f‑stop."}, {"title": "Layered street (70mm)", "detail": "Stack elements; shoot through foreground."}, {"title": "Signage type", "detail": "Tight crop of iconic typography or tile work."}]}, {"id": "the_high_line_10th_ave_overlook_spur", "name": "The High Line — 10th Ave Overlook / Spur", "day": "2025-10-03", "block": "Afternoon", "rank": 5, "bearing": "W to Hudson; S/N along 10th Ave", "whyNow": "Sun slicing between buildings; framed street scenes.", "gear": "24–70mm; 24–70mm (at 70mm) or 50mm (crop)", "settings": "Work shade and geometry; CPL for glare; 1/250s+ @ f/5.6–8.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7425, "lon": -74.0061}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 270, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 270, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 270, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Shadow geometry", "detail": "Look for repeating cast-iron, stoops, or rails to form patterns."}, {"title": "Street portrait moment", "detail": "Use 35/50mm for environmental portraits; ask politely."}, {"title": "Compression detail", "detail": "Use the 70mm end of 24–70; crop if needed for stronger layers."}], "shots": [{"title": "Shadow lattice (24–70mm)", "detail": "Catch window/railing shadows making a grid or stripes."}, {"title": "Corner portrait (35/50mm)", "detail": "Subject on edge of light; background in soft shade."}, {"title": "Texture macro (50mm)", "detail": "Look for worn stone/metal details; low ISO, high f‑stop."}, {"title": "Layered street (70mm)", "detail": "Stack elements; shoot through foreground."}, {"title": "Signage type", "detail": "Tight crop of iconic typography or tile work."}]}, {"id": "top_of_the_rock_observation_deck", "name": "Top of the Rock — Observation Deck", "day": "2025-10-03", "block": "Evening", "rank": 1, "bearing": "W & S (sunset, ESB)", "whyNow": "Arrive 60–90 min pre‑sunset; no tripods on deck.", "gear": "16–24mm; 24–70mm; cloth", "settings": "Blue-hour blend; 1/60–1s @ f/5.6–8, ISO 100–800; bracketing if needed.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7591, "lon": -73.9795}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 270, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 270, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 270, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Blue-hour reflections", "detail": "Arrive 45–75 min before sunset; water calms near high tide."}, {"title": "Silhouette walkers", "detail": "Expose for sky; use crosswalks as a stage."}, {"title": "Ferry or car streaks", "detail": "1–2s for ferries/traffic; tripod or brace on railing."}], "shots": [{"title": "Blue-hour skyline (16–24mm)", "detail": "Balance ambient & city lights; 10–20 min after sunset."}, {"title": "Silhouette frame (35/50mm)", "detail": "Backlight against sky/water; faster shutter."}, {"title": "Symmetry (24–70mm)", "detail": "Use bridges/arches/railings; centered composition."}, {"title": "Panning ferry (1/8–1/4s)", "detail": "Follow motion for streaky yet readable subject."}, {"title": "Detail twinkle", "detail": "Tight crop on lights/signs; sparkle highlights."}]}, {"id": "gapstow_bridge_central_park", "name": "Gapstow Bridge — Central Park", "day": "2025-10-03", "block": "Evening", "rank": 2, "bearing": "NW toward Midtown", "whyNow": "Shoreline for reflections; silhouettes on bridge.", "gear": "24–70mm (at 70mm) or 50mm (crop); 35mm; CPL", "settings": "Blue-hour blend; 1/60–1s @ f/5.6–8, ISO 100–800; bracketing if needed.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7641, "lon": -73.9739}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 315, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 315, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 315, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Blue-hour reflections", "detail": "Arrive 45–75 min before sunset; water calms near high tide."}, {"title": "Silhouette walkers", "detail": "Expose for sky; use crosswalks as a stage."}, {"title": "Ferry or car streaks", "detail": "1–2s for ferries/traffic; tripod or brace on railing."}], "shots": [{"title": "Blue-hour skyline (16–24mm)", "detail": "Balance ambient & city lights; 10–20 min after sunset."}, {"title": "Silhouette frame (35/50mm)", "detail": "Backlight against sky/water; faster shutter."}, {"title": "Symmetry (24–70mm)", "detail": "Use bridges/arches/railings; centered composition."}, {"title": "Panning ferry (1/8–1/4s)", "detail": "Follow motion for streaky yet readable subject."}, {"title": "Detail twinkle", "detail": "Tight crop on lights/signs; sparkle highlights."}]}, {"id": "brooklyn_bridge_park_pier_1_pilings", "name": "Brooklyn Bridge Park — Pier 1 (Pilings)", "day": "2025-10-03", "block": "Evening", "rank": 3, "bearing": "WSW to skyline", "whyNow": "Repeating pilings foreground; ferry streaks at blue hour.", "gear": "16–24mm; ND; tripod", "settings": "Blue-hour blend; 1/60–1s @ f/5.6–8, ISO 100–800; bracketing if needed.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7021, "lon": -73.9969}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 247.5, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 247.5, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 247.5, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Blue-hour reflections", "detail": "Arrive 45–75 min before sunset; water calms near high tide."}, {"title": "Silhouette walkers", "detail": "Expose for sky; use crosswalks as a stage."}, {"title": "Ferry or car streaks", "detail": "1–2s for ferries/traffic; tripod or brace on railing."}], "shots": [{"title": "Blue-hour skyline (16–24mm)", "detail": "Balance ambient & city lights; 10–20 min after sunset."}, {"title": "Silhouette frame (35/50mm)", "detail": "Backlight against sky/water; faster shutter."}, {"title": "Symmetry (24–70mm)", "detail": "Use bridges/arches/railings; centered composition."}, {"title": "Panning ferry (1/8–1/4s)", "detail": "Follow motion for streaky yet readable subject."}, {"title": "Detail twinkle", "detail": "Tight crop on lights/signs; sparkle highlights."}]}, {"id": "roosevelt_island_tram_queensboro_bridge", "name": "Roosevelt Island Tram & Queensboro Bridge", "day": "2025-10-03", "block": "Evening", "rank": 4, "bearing": "W toward Midtown", "whyNow": "Tram motion blur; bridge tower geometry.", "gear": "24–70mm; 24–70mm (at 70mm) or 50mm (crop)", "settings": "Blue-hour blend; 1/60–1s @ f/5.6–8, ISO 100–800; bracketing if needed.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7615, "lon": -73.9597}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 270, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 270, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 270, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Blue-hour reflections", "detail": "Arrive 45–75 min before sunset; water calms near high tide."}, {"title": "Silhouette walkers", "detail": "Expose for sky; use crosswalks as a stage."}, {"title": "Ferry or car streaks", "detail": "1–2s for ferries/traffic; tripod or brace on railing."}], "shots": [{"title": "Blue-hour skyline (16–24mm)", "detail": "Balance ambient & city lights; 10–20 min after sunset."}, {"title": "Silhouette frame (35/50mm)", "detail": "Backlight against sky/water; faster shutter."}, {"title": "Symmetry (24–70mm)", "detail": "Use bridges/arches/railings; centered composition."}, {"title": "Panning ferry (1/8–1/4s)", "detail": "Follow motion for streaky yet readable subject."}, {"title": "Detail twinkle", "detail": "Tight crop on lights/signs; sparkle highlights."}]}, {"id": "belvedere_castle_turtle_pond", "name": "Belvedere Castle & Turtle Pond", "day": "2025-10-03", "block": "Evening", "rank": 5, "bearing": "SE/NW options", "whyNow": "Castle silhouettes; pond reflections as light drops.", "gear": "24–70mm; 16–24mm", "settings": "Blue-hour blend; 1/60–1s @ f/5.6–8, ISO 100–800; bracketing if needed.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7794, "lon": -73.969}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 135, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 135, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 135, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Blue-hour reflections", "detail": "Arrive 45–75 min before sunset; water calms near high tide."}, {"title": "Silhouette walkers", "detail": "Expose for sky; use crosswalks as a stage."}, {"title": "Ferry or car streaks", "detail": "1–2s for ferries/traffic; tripod or brace on railing."}], "shots": [{"title": "Blue-hour skyline (16–24mm)", "detail": "Balance ambient & city lights; 10–20 min after sunset."}, {"title": "Silhouette frame (35/50mm)", "detail": "Backlight against sky/water; faster shutter."}, {"title": "Symmetry (24–70mm)", "detail": "Use bridges/arches/railings; centered composition."}, {"title": "Panning ferry (1/8–1/4s)", "detail": "Follow motion for streaky yet readable subject."}, {"title": "Detail twinkle", "detail": "Tight crop on lights/signs; sparkle highlights."}]}, {"id": "times_square_duffy_square", "name": "Times Square — Duffy Square", "day": "2025-10-03", "block": "Night", "rank": 1, "bearing": "Broadway & 7th Ave", "whyNow": "Neon people blur 4–10s; portraits at f/1.8–2.8.", "gear": "24–70mm; fast 50mm; mini‑tripod", "settings": "Tripod: 1–10s @ f/6.3–8, ISO 100–400; expose for highlights.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.758, "lon": -73.9855}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 0.0, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 0.0, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 0.0, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Clean tripod placement", "detail": "Stay behind safety lines; avoid blocking paths."}, {"title": "Neon trails", "detail": "1–4s exposures; wait for buses to paint the frame."}, {"title": "Skyline mirror", "detail": "Use 16–24 for big scene; 50mm for graphic details."}], "shots": [{"title": "Long exposure base (16–24mm)", "detail": "1–10s; shoot 10–20 frames; pick best trails."}, {"title": "Tele crop (50/70mm)", "detail": "Abstract geometry; isolate building tops."}, {"title": "Reflections", "detail": "Find puddles or river edges; go low for mirror."}, {"title": "People blur (1–2s)", "detail": "Trace flows of commuters without losing structure."}, {"title": "Icon detail", "detail": "Tight shot of recognizable element to close the set."}]}, {"id": "tudor_city_overpass_e_42nd_st", "name": "Tudor City Overpass (E 42nd St)", "day": "2025-10-03", "block": "Night", "rank": 2, "bearing": "WSW down 42nd St", "whyNow": "Chrysler crown + headlight trails 8–20s.", "gear": "24–70mm (at 70mm) or 50mm (crop); tripod; remote", "settings": "Tripod: 1–10s @ f/6.3–8, ISO 100–400; expose for highlights.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7495, "lon": -73.9725}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 247.5, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 247.5, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 247.5, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Clean tripod placement", "detail": "Stay behind safety lines; avoid blocking paths."}, {"title": "Neon trails", "detail": "1–4s exposures; wait for buses to paint the frame."}, {"title": "Skyline mirror", "detail": "Use 16–24 for big scene; 50mm for graphic details."}], "shots": [{"title": "Long exposure base (16–24mm)", "detail": "1–10s; shoot 10–20 frames; pick best trails."}, {"title": "Tele crop (50/70mm)", "detail": "Abstract geometry; isolate building tops."}, {"title": "Reflections", "detail": "Find puddles or river edges; go low for mirror."}, {"title": "People blur (1–2s)", "detail": "Trace flows of commuters without losing structure."}, {"title": "Icon detail", "detail": "Tight shot of recognizable element to close the set."}]}, {"id": "rockefeller_center_channel_gardens", "name": "Rockefeller Center — Channel Gardens", "day": "2025-10-03", "block": "Night", "rank": 3, "bearing": "S toward 30 Rock", "whyNow": "Flags, fountains, reflections; seasonal installs.", "gear": "24–70mm; fast 35mm", "settings": "Tripod: 1–10s @ f/6.3–8, ISO 100–400; expose for highlights.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7586, "lon": -73.9787}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 180, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 180, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 180, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Clean tripod placement", "detail": "Stay behind safety lines; avoid blocking paths."}, {"title": "Neon trails", "detail": "1–4s exposures; wait for buses to paint the frame."}, {"title": "Skyline mirror", "detail": "Use 16–24 for big scene; 50mm for graphic details."}], "shots": [{"title": "Long exposure base (16–24mm)", "detail": "1–10s; shoot 10–20 frames; pick best trails."}, {"title": "Tele crop (50/70mm)", "detail": "Abstract geometry; isolate building tops."}, {"title": "Reflections", "detail": "Find puddles or river edges; go low for mirror."}, {"title": "People blur (1–2s)", "detail": "Trace flows of commuters without losing structure."}, {"title": "Icon detail", "detail": "Tight shot of recognizable element to close the set."}]}, {"id": "flatiron_at_night_23rd_broadway", "name": "Flatiron at Night (23rd & Broadway)", "day": "2025-10-03", "block": "Night", "rank": 4, "bearing": "NNE along 5th Ave", "whyNow": "Taxi streaks; puddle mirrors near crosswalks.", "gear": "24–70mm; tripod", "settings": "Tripod: 1–10s @ f/6.3–8, ISO 100–400; expose for highlights.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7411, "lon": -73.9897}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 22.5, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 22.5, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 22.5, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Clean tripod placement", "detail": "Stay behind safety lines; avoid blocking paths."}, {"title": "Neon trails", "detail": "1–4s exposures; wait for buses to paint the frame."}, {"title": "Skyline mirror", "detail": "Use 16–24 for big scene; 50mm for graphic details."}], "shots": [{"title": "Long exposure base (16–24mm)", "detail": "1–10s; shoot 10–20 frames; pick best trails."}, {"title": "Tele crop (50/70mm)", "detail": "Abstract geometry; isolate building tops."}, {"title": "Reflections", "detail": "Find puddles or river edges; go low for mirror."}, {"title": "People blur (1–2s)", "detail": "Trace flows of commuters without losing structure."}, {"title": "Icon detail", "detail": "Tight shot of recognizable element to close the set."}]}, {"id": "brooklyn_bridge_walkway_night_symmetry", "name": "Brooklyn Bridge — Walkway (night symmetry)", "day": "2025-10-03", "block": "Night", "rank": 5, "bearing": "WNW to skyline", "whyNow": "Cable geometry; keep to the side, be mindful of cyclists.", "gear": "16–24mm; clamp", "settings": "Tripod: 1–10s @ f/6.3–8, ISO 100–400; expose for highlights.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7067, "lon": -73.9967}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 292.5, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 292.5, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 292.5, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Clean tripod placement", "detail": "Stay behind safety lines; avoid blocking paths."}, {"title": "Neon trails", "detail": "1–4s exposures; wait for buses to paint the frame."}, {"title": "Skyline mirror", "detail": "Use 16–24 for big scene; 50mm for graphic details."}], "shots": [{"title": "Long exposure base (16–24mm)", "detail": "1–10s; shoot 10–20 frames; pick best trails."}, {"title": "Tele crop (50/70mm)", "detail": "Abstract geometry; isolate building tops."}, {"title": "Reflections", "detail": "Find puddles or river edges; go low for mirror."}, {"title": "People blur (1–2s)", "detail": "Trace flows of commuters without losing structure."}, {"title": "Icon detail", "detail": "Tight shot of recognizable element to close the set."}]}, {"id": "bethesda_terrace_arcade", "name": "Bethesda Terrace — Arcade", "day": "2025-10-04", "block": "Morning", "rank": 1, "bearing": "N/S arcade axis", "whyNow": "Start at civil dawn; vanishing arches + warm side‑light.", "gear": "24–70mm; fast 35mm", "settings": "Arrive 30–60 min before sunrise; handheld 1/250s+ @ f/5.6–8, ISO 100–400.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7741, "lon": -73.9701}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 0, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 0, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 0, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Parking gap watch", "detail": "Scan for a temporary gap to remove parked cars; be ready to shoot quickly."}, {"title": "Reflections after wash", "detail": "Street or lawn irrigation leaves sheen—use CPL to control glare."}, {"title": "Taxi or jogger streaks", "detail": "If traffic begins, try 1/8–1/2s for motion streaks."}], "shots": [{"title": "Establishing wide (16–24mm)", "detail": "Include context and sky color; keep verticals straight."}, {"title": "Low angle leading lines", "detail": "Camera close to ground; emphasize texture or rails."}, {"title": "Human scale", "detail": "Single figure walking/running; time the stride."}, {"title": "Compressed crop (50/70mm)", "detail": "Use longer end for a clean graphic frame; crop if needed."}, {"title": "Detail cutaway", "detail": "Reflections, signage, patterns that summarize place."}]}, {"id": "bow_bridge_the_lake", "name": "Bow Bridge — The Lake", "day": "2025-10-04", "block": "Morning", "rank": 2, "bearing": "W/NW across The Lake", "whyNow": "Reflections; rowboats add scale; avoid mid‑bridge vibration.", "gear": "24–70mm (at 70mm) or 50mm (crop); CPL", "settings": "Arrive 30–60 min before sunrise; handheld 1/250s+ @ f/5.6–8, ISO 100–400.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7755, "lon": -73.9703}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 270, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 270, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 270, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Parking gap watch", "detail": "Scan for a temporary gap to remove parked cars; be ready to shoot quickly."}, {"title": "Reflections after wash", "detail": "Street or lawn irrigation leaves sheen—use CPL to control glare."}, {"title": "Taxi or jogger streaks", "detail": "If traffic begins, try 1/8–1/2s for motion streaks."}], "shots": [{"title": "Establishing wide (16–24mm)", "detail": "Include context and sky color; keep verticals straight."}, {"title": "Low angle leading lines", "detail": "Camera close to ground; emphasize texture or rails."}, {"title": "Human scale", "detail": "Single figure walking/running; time the stride."}, {"title": "Compressed crop (50/70mm)", "detail": "Use longer end for a clean graphic frame; crop if needed."}, {"title": "Detail cutaway", "detail": "Reflections, signage, patterns that summarize place."}]}, {"id": "the_mall_literary_walk", "name": "The Mall / Literary Walk", "day": "2025-10-04", "block": "Morning", "rank": 3, "bearing": "S/N tree tunnel", "whyNow": "Vanishing lines; portraits with layered bokeh.", "gear": "35/85mm primes", "settings": "Arrive 30–60 min before sunrise; handheld 1/250s+ @ f/5.6–8, ISO 100–400.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7735, "lon": -73.9719}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 180, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 180, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 180, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Parking gap watch", "detail": "Scan for a temporary gap to remove parked cars; be ready to shoot quickly."}, {"title": "Reflections after wash", "detail": "Street or lawn irrigation leaves sheen—use CPL to control glare."}, {"title": "Taxi or jogger streaks", "detail": "If traffic begins, try 1/8–1/2s for motion streaks."}], "shots": [{"title": "Establishing wide (16–24mm)", "detail": "Include context and sky color; keep verticals straight."}, {"title": "Low angle leading lines", "detail": "Camera close to ground; emphasize texture or rails."}, {"title": "Human scale", "detail": "Single figure walking/running; time the stride."}, {"title": "Compressed crop (50/70mm)", "detail": "Use longer end for a clean graphic frame; crop if needed."}, {"title": "Detail cutaway", "detail": "Reflections, signage, patterns that summarize place."}]}, {"id": "the_ramble_central_park", "name": "The Ramble (Central Park)", "day": "2025-10-04", "block": "Morning", "rank": 4, "bearing": "Woodland pockets", "whyNow": "Boardwalk reflections; winding paths; birds.", "gear": "24–70mm (at 70mm) or 50mm (crop); close‑up filter", "settings": "Arrive 30–60 min before sunrise; handheld 1/250s+ @ f/5.6–8, ISO 100–400.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7783, "lon": -73.9715}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 0.0, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 0.0, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 0.0, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Parking gap watch", "detail": "Scan for a temporary gap to remove parked cars; be ready to shoot quickly."}, {"title": "Reflections after wash", "detail": "Street or lawn irrigation leaves sheen—use CPL to control glare."}, {"title": "Taxi or jogger streaks", "detail": "If traffic begins, try 1/8–1/2s for motion streaks."}], "shots": [{"title": "Establishing wide (16–24mm)", "detail": "Include context and sky color; keep verticals straight."}, {"title": "Low angle leading lines", "detail": "Camera close to ground; emphasize texture or rails."}, {"title": "Human scale", "detail": "Single figure walking/running; time the stride."}, {"title": "Compressed crop (50/70mm)", "detail": "Use longer end for a clean graphic frame; crop if needed."}, {"title": "Detail cutaway", "detail": "Reflections, signage, patterns that summarize place."}]}, {"id": "conservatory_water_alice_statue", "name": "Conservatory Water & 'Alice' Statue", "day": "2025-10-04", "block": "Morning", "rank": 5, "bearing": "W toward UES skyline", "whyNow": "RC boats; statue details; mirror water in calm air.", "gear": "24–70mm; 24–70mm (at 70mm) or 50mm (crop)", "settings": "Arrive 30–60 min before sunrise; handheld 1/250s+ @ f/5.6–8, ISO 100–400.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7759, "lon": -73.9667}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 270, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 270, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 270, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Parking gap watch", "detail": "Scan for a temporary gap to remove parked cars; be ready to shoot quickly."}, {"title": "Reflections after wash", "detail": "Street or lawn irrigation leaves sheen—use CPL to control glare."}, {"title": "Taxi or jogger streaks", "detail": "If traffic begins, try 1/8–1/2s for motion streaks."}], "shots": [{"title": "Establishing wide (16–24mm)", "detail": "Include context and sky color; keep verticals straight."}, {"title": "Low angle leading lines", "detail": "Camera close to ground; emphasize texture or rails."}, {"title": "Human scale", "detail": "Single figure walking/running; time the stride."}, {"title": "Compressed crop (50/70mm)", "detail": "Use longer end for a clean graphic frame; crop if needed."}, {"title": "Detail cutaway", "detail": "Reflections, signage, patterns that summarize place."}]}, {"id": "soho_greene_prince", "name": "SoHo — Greene & Prince", "day": "2025-10-04", "block": "Afternoon", "rank": 1, "bearing": "N/S street axes", "whyNow": "Cast‑iron façades; cobbles; shadow geometry.", "gear": "35mm prime; CPL", "settings": "Work shade and geometry; CPL for glare; 1/250s+ @ f/5.6–8.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7249, "lon": -74.002}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 0, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 0, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 0, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Shadow geometry", "detail": "Look for repeating cast-iron, stoops, or rails to form patterns."}, {"title": "Street portrait moment", "detail": "Use 35/50mm for environmental portraits; ask politely."}, {"title": "Compression detail", "detail": "Use the 70mm end of 24–70; crop if needed for stronger layers."}], "shots": [{"title": "Shadow lattice (24–70mm)", "detail": "Catch window/railing shadows making a grid or stripes."}, {"title": "Corner portrait (35/50mm)", "detail": "Subject on edge of light; background in soft shade."}, {"title": "Texture macro (50mm)", "detail": "Look for worn stone/metal details; low ISO, high f‑stop."}, {"title": "Layered street (70mm)", "detail": "Stack elements; shoot through foreground."}, {"title": "Signage type", "detail": "Tight crop of iconic typography or tile work."}]}, {"id": "west_village_grove_bedford", "name": "West Village — Grove & Bedford", "day": "2025-10-04", "block": "Afternoon", "rank": 2, "bearing": "W/E side‑streets", "whyNow": "Brownstone stoops; café life; tele details of signage.", "gear": "35/50mm fast prime", "settings": "Work shade and geometry; CPL for glare; 1/250s+ @ f/5.6–8.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7326, "lon": -74.0063}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 270, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 270, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 270, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Shadow geometry", "detail": "Look for repeating cast-iron, stoops, or rails to form patterns."}, {"title": "Street portrait moment", "detail": "Use 35/50mm for environmental portraits; ask politely."}, {"title": "Compression detail", "detail": "Use the 70mm end of 24–70; crop if needed for stronger layers."}], "shots": [{"title": "Shadow lattice (24–70mm)", "detail": "Catch window/railing shadows making a grid or stripes."}, {"title": "Corner portrait (35/50mm)", "detail": "Subject on edge of light; background in soft shade."}, {"title": "Texture macro (50mm)", "detail": "Look for worn stone/metal details; low ISO, high f‑stop."}, {"title": "Layered street (70mm)", "detail": "Stack elements; shoot through foreground."}, {"title": "Signage type", "detail": "Tight crop of iconic typography or tile work."}]}, {"id": "chinatown_doyers_st_bloody_angle", "name": "Chinatown — Doyers St (Bloody Angle)", "day": "2025-10-04", "block": "Afternoon", "rank": 3, "bearing": "SE curve alley", "whyNow": "Lanterns; scooter pans at 1/15–1/25s; typography.", "gear": "24–70mm; fast 35mm", "settings": "Work shade and geometry; CPL for glare; 1/250s+ @ f/5.6–8.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7149, "lon": -73.9968}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 135, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 135, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 135, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Shadow geometry", "detail": "Look for repeating cast-iron, stoops, or rails to form patterns."}, {"title": "Street portrait moment", "detail": "Use 35/50mm for environmental portraits; ask politely."}, {"title": "Compression detail", "detail": "Use the 70mm end of 24–70; crop if needed for stronger layers."}], "shots": [{"title": "Shadow lattice (24–70mm)", "detail": "Catch window/railing shadows making a grid or stripes."}, {"title": "Corner portrait (35/50mm)", "detail": "Subject on edge of light; background in soft shade."}, {"title": "Texture macro (50mm)", "detail": "Look for worn stone/metal details; low ISO, high f‑stop."}, {"title": "Layered street (70mm)", "detail": "Stack elements; shoot through foreground."}, {"title": "Signage type", "detail": "Tight crop of iconic typography or tile work."}]}, {"id": "lower_east_side_orchard_st", "name": "Lower East Side — Orchard St", "day": "2025-10-04", "block": "Afternoon", "rank": 4, "bearing": "N/S urban canyon", "whyNow": "Tenement façades; murals; market candids.", "gear": "35mm; 24–70mm (at 70mm) or 50mm (crop)", "settings": "Work shade and geometry; CPL for glare; 1/250s+ @ f/5.6–8.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7196, "lon": -73.9896}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 0, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 0, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 0, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Shadow geometry", "detail": "Look for repeating cast-iron, stoops, or rails to form patterns."}, {"title": "Street portrait moment", "detail": "Use 35/50mm for environmental portraits; ask politely."}, {"title": "Compression detail", "detail": "Use the 70mm end of 24–70; crop if needed for stronger layers."}], "shots": [{"title": "Shadow lattice (24–70mm)", "detail": "Catch window/railing shadows making a grid or stripes."}, {"title": "Corner portrait (35/50mm)", "detail": "Subject on edge of light; background in soft shade."}, {"title": "Texture macro (50mm)", "detail": "Look for worn stone/metal details; low ISO, high f‑stop."}, {"title": "Layered street (70mm)", "detail": "Stack elements; shoot through foreground."}, {"title": "Signage type", "detail": "Tight crop of iconic typography or tile work."}]}, {"id": "manhattan_bridge_arch_colonnade_canal_bowery", "name": "Manhattan Bridge Arch & Colonnade (Canal/Bowery)", "day": "2025-10-04", "block": "Afternoon", "rank": 5, "bearing": "W toward arch", "whyNow": "Classical arch symmetry; taxi/bus streaks.", "gear": "24–70mm; ND", "settings": "Work shade and geometry; CPL for glare; 1/250s+ @ f/5.6–8.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7139, "lon": -73.9967}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 270, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 270, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 270, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Shadow geometry", "detail": "Look for repeating cast-iron, stoops, or rails to form patterns."}, {"title": "Street portrait moment", "detail": "Use 35/50mm for environmental portraits; ask politely."}, {"title": "Compression detail", "detail": "Use the 70mm end of 24–70; crop if needed for stronger layers."}], "shots": [{"title": "Shadow lattice (24–70mm)", "detail": "Catch window/railing shadows making a grid or stripes."}, {"title": "Corner portrait (35/50mm)", "detail": "Subject on edge of light; background in soft shade."}, {"title": "Texture macro (50mm)", "detail": "Look for worn stone/metal details; low ISO, high f‑stop."}, {"title": "Layered street (70mm)", "detail": "Stack elements; shoot through foreground."}, {"title": "Signage type", "detail": "Tight crop of iconic typography or tile work."}]}, {"id": "gantry_plaza_state_park_lic", "name": "Gantry Plaza State Park (LIC)", "day": "2025-10-04", "block": "Evening", "rank": 1, "bearing": "W to Midtown", "whyNow": "Boardwalk S‑curve; skyline pano; check wind for reflections.", "gear": "24–70mm; ND; tripod", "settings": "Blue-hour blend; 1/60–1s @ f/5.6–8, ISO 100–800; bracketing if needed.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7447, "lon": -73.9576}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 270, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 270, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 270, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Blue-hour reflections", "detail": "Arrive 45–75 min before sunset; water calms near high tide."}, {"title": "Silhouette walkers", "detail": "Expose for sky; use crosswalks as a stage."}, {"title": "Ferry or car streaks", "detail": "1–2s for ferries/traffic; tripod or brace on railing."}], "shots": [{"title": "Blue-hour skyline (16–24mm)", "detail": "Balance ambient & city lights; 10–20 min after sunset."}, {"title": "Silhouette frame (35/50mm)", "detail": "Backlight against sky/water; faster shutter."}, {"title": "Symmetry (24–70mm)", "detail": "Use bridges/arches/railings; centered composition."}, {"title": "Panning ferry (1/8–1/4s)", "detail": "Follow motion for streaky yet readable subject."}, {"title": "Detail twinkle", "detail": "Tight crop on lights/signs; sparkle highlights."}]}, {"id": "domino_park_williamsburg", "name": "Domino Park (Williamsburg)", "day": "2025-10-04", "block": "Evening", "rank": 2, "bearing": "W/SW to skyline", "whyNow": "Catwalk frames; ferry streaks; bridge tele.", "gear": "24–70mm; 24–70mm (at 70mm) or 50mm (crop); CPL", "settings": "Blue-hour blend; 1/60–1s @ f/5.6–8, ISO 100–800; bracketing if needed.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7145, "lon": -73.9672}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 270, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 270, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 270, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Blue-hour reflections", "detail": "Arrive 45–75 min before sunset; water calms near high tide."}, {"title": "Silhouette walkers", "detail": "Expose for sky; use crosswalks as a stage."}, {"title": "Ferry or car streaks", "detail": "1–2s for ferries/traffic; tripod or brace on railing."}], "shots": [{"title": "Blue-hour skyline (16–24mm)", "detail": "Balance ambient & city lights; 10–20 min after sunset."}, {"title": "Silhouette frame (35/50mm)", "detail": "Backlight against sky/water; faster shutter."}, {"title": "Symmetry (24–70mm)", "detail": "Use bridges/arches/railings; centered composition."}, {"title": "Panning ferry (1/8–1/4s)", "detail": "Follow motion for streaky yet readable subject."}, {"title": "Detail twinkle", "detail": "Tight crop on lights/signs; sparkle highlights."}]}, {"id": "four_freedoms_park_roosevelt_island_tip", "name": "Four Freedoms Park (Roosevelt Island tip)", "day": "2025-10-04", "block": "Evening", "rank": 3, "bearing": "WSW toward Midtown East", "whyNow": "Tree allée symmetry; granite minimalism; UN skyline.", "gear": "16–24mm; 24–70mm (at 70mm) or 50mm (crop); tripod", "settings": "Blue-hour blend; 1/60–1s @ f/5.6–8, ISO 100–800; bracketing if needed.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7532, "lon": -73.9544}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 247.5, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 247.5, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 247.5, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Blue-hour reflections", "detail": "Arrive 45–75 min before sunset; water calms near high tide."}, {"title": "Silhouette walkers", "detail": "Expose for sky; use crosswalks as a stage."}, {"title": "Ferry or car streaks", "detail": "1–2s for ferries/traffic; tripod or brace on railing."}], "shots": [{"title": "Blue-hour skyline (16–24mm)", "detail": "Balance ambient & city lights; 10–20 min after sunset."}, {"title": "Silhouette frame (35/50mm)", "detail": "Backlight against sky/water; faster shutter."}, {"title": "Symmetry (24–70mm)", "detail": "Use bridges/arches/railings; centered composition."}, {"title": "Panning ferry (1/8–1/4s)", "detail": "Follow motion for streaky yet readable subject."}, {"title": "Detail twinkle", "detail": "Tight crop on lights/signs; sparkle highlights."}]}, {"id": "battery_park_esplanade", "name": "Battery Park Esplanade", "day": "2025-10-04", "block": "Evening", "rank": 4, "bearing": "SW/W to harbor", "whyNow": "Tele Statue of Liberty; jogger silhouettes; golden water.", "gear": "24–70mm (at 70mm) or 50mm (crop); ND", "settings": "Blue-hour blend; 1/60–1s @ f/5.6–8, ISO 100–800; bracketing if needed.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7033, "lon": -74.017}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 225, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 225, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 225, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Blue-hour reflections", "detail": "Arrive 45–75 min before sunset; water calms near high tide."}, {"title": "Silhouette walkers", "detail": "Expose for sky; use crosswalks as a stage."}, {"title": "Ferry or car streaks", "detail": "1–2s for ferries/traffic; tripod or brace on railing."}], "shots": [{"title": "Blue-hour skyline (16–24mm)", "detail": "Balance ambient & city lights; 10–20 min after sunset."}, {"title": "Silhouette frame (35/50mm)", "detail": "Backlight against sky/water; faster shutter."}, {"title": "Symmetry (24–70mm)", "detail": "Use bridges/arches/railings; centered composition."}, {"title": "Panning ferry (1/8–1/4s)", "detail": "Follow motion for streaky yet readable subject."}, {"title": "Detail twinkle", "detail": "Tight crop on lights/signs; sparkle highlights."}]}, {"id": "hoboken_pier_a_park", "name": "Hoboken — Pier A Park", "day": "2025-10-04", "block": "Evening", "rank": 5, "bearing": "E to Lower Manhattan", "whyNow": "Full skyline pano; path lamps for starbursts at f/16.", "gear": "24–70mm; tripod", "settings": "Blue-hour blend; 1/60–1s @ f/5.6–8, ISO 100–800; bracketing if needed.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7378, "lon": -74.0261}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 90, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 90, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 90, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Blue-hour reflections", "detail": "Arrive 45–75 min before sunset; water calms near high tide."}, {"title": "Silhouette walkers", "detail": "Expose for sky; use crosswalks as a stage."}, {"title": "Ferry or car streaks", "detail": "1–2s for ferries/traffic; tripod or brace on railing."}], "shots": [{"title": "Blue-hour skyline (16–24mm)", "detail": "Balance ambient & city lights; 10–20 min after sunset."}, {"title": "Silhouette frame (35/50mm)", "detail": "Backlight against sky/water; faster shutter."}, {"title": "Symmetry (24–70mm)", "detail": "Use bridges/arches/railings; centered composition."}, {"title": "Panning ferry (1/8–1/4s)", "detail": "Follow motion for streaky yet readable subject."}, {"title": "Detail twinkle", "detail": "Tight crop on lights/signs; sparkle highlights."}]}, {"id": "jane_s_carousel_dumbo", "name": "Jane’s Carousel (DUMBO)", "day": "2025-10-04", "block": "Night", "rank": 1, "bearing": "W & N to bridges/skyline", "whyNow": "Carousel glow + long exposure boats.", "gear": "24–70mm; mini‑tripod; ND", "settings": "Tripod: 1–10s @ f/6.3–8, ISO 100–400; expose for highlights.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7033, "lon": -73.996}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 270, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 270, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 270, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Clean tripod placement", "detail": "Stay behind safety lines; avoid blocking paths."}, {"title": "Neon trails", "detail": "1–4s exposures; wait for buses to paint the frame."}, {"title": "Skyline mirror", "detail": "Use 16–24 for big scene; 50mm for graphic details."}], "shots": [{"title": "Long exposure base (16–24mm)", "detail": "1–10s; shoot 10–20 frames; pick best trails."}, {"title": "Tele crop (50/70mm)", "detail": "Abstract geometry; isolate building tops."}, {"title": "Reflections", "detail": "Find puddles or river edges; go low for mirror."}, {"title": "People blur (1–2s)", "detail": "Trace flows of commuters without losing structure."}, {"title": "Icon detail", "detail": "Tight shot of recognizable element to close the set."}]}, {"id": "hunters_point_south_park_lic", "name": "Hunters Point South Park (LIC)", "day": "2025-10-04", "block": "Night", "rank": 2, "bearing": "W/SW to Midtown", "whyNow": "Midtown mirror on calm nights; ferry trails 10–30s.", "gear": "16–24mm; tripod", "settings": "Tripod: 1–10s @ f/6.3–8, ISO 100–400; expose for highlights.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.744, "lon": -73.9581}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 270, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 270, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 270, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Clean tripod placement", "detail": "Stay behind safety lines; avoid blocking paths."}, {"title": "Neon trails", "detail": "1–4s exposures; wait for buses to paint the frame."}, {"title": "Skyline mirror", "detail": "Use 16–24 for big scene; 50mm for graphic details."}], "shots": [{"title": "Long exposure base (16–24mm)", "detail": "1–10s; shoot 10–20 frames; pick best trails."}, {"title": "Tele crop (50/70mm)", "detail": "Abstract geometry; isolate building tops."}, {"title": "Reflections", "detail": "Find puddles or river edges; go low for mirror."}, {"title": "People blur (1–2s)", "detail": "Trace flows of commuters without losing structure."}, {"title": "Icon detail", "detail": "Tight shot of recognizable element to close the set."}]}, {"id": "brooklyn_heights_promenade_night_skyline", "name": "Brooklyn Heights Promenade (night skyline)", "day": "2025-10-04", "block": "Night", "rank": 3, "bearing": "WSW across East River", "whyNow": "Blue‑hour pano; BQE light ribbons below in places.", "gear": "24–70mm; tripod", "settings": "Tripod: 1–10s @ f/6.3–8, ISO 100–400; expose for highlights.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.6969, "lon": -73.9969}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 247.5, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 247.5, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 247.5, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Clean tripod placement", "detail": "Stay behind safety lines; avoid blocking paths."}, {"title": "Neon trails", "detail": "1–4s exposures; wait for buses to paint the frame."}, {"title": "Skyline mirror", "detail": "Use 16–24 for big scene; 50mm for graphic details."}], "shots": [{"title": "Long exposure base (16–24mm)", "detail": "1–10s; shoot 10–20 frames; pick best trails."}, {"title": "Tele crop (50/70mm)", "detail": "Abstract geometry; isolate building tops."}, {"title": "Reflections", "detail": "Find puddles or river edges; go low for mirror."}, {"title": "People blur (1–2s)", "detail": "Trace flows of commuters without losing structure."}, {"title": "Icon detail", "detail": "Tight shot of recognizable element to close the set."}]}, {"id": "manhattan_bridge_pedestrian_walkway_night", "name": "Manhattan Bridge — Pedestrian Walkway (night)", "day": "2025-10-04", "block": "Night", "rank": 4, "bearing": "SW toward FiDi", "whyNow": "Train streaks; industrial geometry; gritty B&W options.", "gear": "24–70mm; tripod", "settings": "Tripod: 1–10s @ f/6.3–8, ISO 100–400; expose for highlights.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7132, "lon": -73.993}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 225, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 225, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 225, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Clean tripod placement", "detail": "Stay behind safety lines; avoid blocking paths."}, {"title": "Neon trails", "detail": "1–4s exposures; wait for buses to paint the frame."}, {"title": "Skyline mirror", "detail": "Use 16–24 for big scene; 50mm for graphic details."}], "shots": [{"title": "Long exposure base (16–24mm)", "detail": "1–10s; shoot 10–20 frames; pick best trails."}, {"title": "Tele crop (50/70mm)", "detail": "Abstract geometry; isolate building tops."}, {"title": "Reflections", "detail": "Find puddles or river edges; go low for mirror."}, {"title": "People blur (1–2s)", "detail": "Trace flows of commuters without losing structure."}, {"title": "Icon detail", "detail": "Tight shot of recognizable element to close the set."}]}, {"id": "34th_st_6th_ave_herald_sq_esb_crosswalk_trails", "name": "34th St & 6th Ave (Herald Sq — ESB crosswalk trails)", "day": "2025-10-04", "block": "Night", "rank": 5, "bearing": "N/E to ESB", "whyNow": "Crosswalk light trails with ESB framed above.", "gear": "24–70mm; tripod", "settings": "Tripod: 1–10s @ f/6.3–8, ISO 100–400; expose for highlights.", "activeAnchor": 0, "anchors": [{"label": "Main view", "lat": 40.7496, "lon": -73.987}], "micro": [{"title": "Centerline", "r": 0.0, "bearing": 0, "dir": "", "detail": "Main alignment from anchor."}, {"title": "Step‑back", "r": 10.0, "bearing": 0, "dir": "", "detail": "Step back ~10 m; arrow still toward subject."}, {"title": "Corner curb", "r": 22.0, "bearing": 0, "dir": "", "detail": "Diagonal curb vantage; arrow toward subject."}], "pins": [{"title": "Clean tripod placement", "detail": "Stay behind safety lines; avoid blocking paths."}, {"title": "Neon trails", "detail": "1–4s exposures; wait for buses to paint the frame."}, {"title": "Skyline mirror", "detail": "Use 16–24 for big scene; 50mm for graphic details."}], "shots": [{"title": "Long exposure base (16–24mm)", "detail": "1–10s; shoot 10–20 frames; pick best trails."}, {"title": "Tele crop (50/70mm)", "detail": "Abstract geometry; isolate building tops."}, {"title": "Reflections", "detail": "Find puddles or river edges; go low for mirror."}, {"title": "People blur (1–2s)", "detail": "Trace flows of commuters without losing structure."}, {"title": "Icon detail", "detail": "Tight shot of recognizable element to close the set."}]}];
let state={dayMap:{'2025-10-03':'2025-10-03','2025-10-04':'2025-10-04'},day:new Set(['2025-10-03','2025-10-04']),blocks:new Set(['Morning','Afternoon','Evening','Night']),rankMin:1,rankMax:5,proOnly:false,q:'',rain:false,wind:false,expandAll:false,editMode:false};
let TIMES={};

const byId=id=>document.getElementById(id);
function fmtHM(d){const t=new Date(d),m=String(t.getMinutes()).padStart(2,'0');let h=t.getHours(),a=h>=12?'pm':'am';h=((h+11)%12)+1;return `${h}:${m} ${a}`;}
function dayLabel(iso){const d=new Date(iso+'T12:00:00-04:00');return new Intl.DateTimeFormat('en-US',{weekday:'short',month:'short',day:'numeric',year:'numeric'}).format(d).replace(',',' •');}
function activeAnchor(l){return l.anchors[l.activeAnchor||0];}
function metersToLatLon(lat,m,deg){const dlat=(m*Math.cos(deg*Math.PI/180))/111111.0;const dlon=(m*Math.sin(deg*Math.PI/180))/(111111.0*Math.cos(lat*Math.PI/180));return {dlat,dlon};}
function computeMicroAbs(l){const a=activeAnchor(l);return (l.micro||[]).map(m=>{const o=metersToLatLon(a.lat,m.r,m.bearing);return {title:m.title,lat:+(a.lat+o.dlat).toFixed(6),lon:+(a.lon+o.dlon).toFixed(6),bearing:m.bearing,detail:m.detail};});}
function visible(){return (LOCATIONS||[]).filter(l=>state.day.has(l.day)&&state.blocks.has(l.block)&&l.rank>=state.rankMin&&l.rank<=state.rankMax);}

function computeTimes(){
  TIMES={};
  ['2025-10-03','2025-10-04'].forEach(k=>{
    const iso=state.dayMap[k], d=new Date(iso+'T12:00:00-04:00');
    const s=SunX.sunTimes(new Date(d), CFG.nyc.lat, CFG.nyc.lon);
    const m=SunX.moonTimes(new Date(d), CFG.nyc.lat, CFG.nyc.lon);
    TIMES[k]={dawn:fmtHM(s.dawn),sunrise:fmtHM(s.sunrise),sunset:fmtHM(s.sunset),dusk:fmtHM(s.dusk),moonrise:m.rise?fmtHM(m.rise):'—',moonset:m.set?fmtHM(m.set):'—',illum:'~'+Math.round(m.illum*100)+'%'};
  });
}

async function fetchNOAA(iso){
  const ymd=iso.replace(/-/g,'');
  const url=`https://api.tidesandcurrents.noaa.gov/api/prod/datagetter?product=predictions&application=nyc-photo-guide&begin_date=${ymd}&end_date=${ymd}&datum=MLLW&station=8518750&time_zone=lst_ldt&interval=hilo&units=english&format=json`;
  try{const r=await fetch(url,{cache:'no-store'});const j=await r.json();if(j&&j.predictions){return j.predictions.map(p=>`${p.t.slice(11,16)} ${p.type} ${(+p.v).toFixed(1)} ft`).join(' • ');} }catch(e){}
  return 'Open NOAA high/low';
}

// Maps
let usingGoogle=false,gmap=null,gPlaces=null,gGeo=null,gDS=null,gDR=null;
let lmap=null,lLayer=null; let mainMarkers={},microMarkers={},arrowPolylines={};

function injectGoogle(){
  return new Promise((res,rej)=>{
    if(window.google&&google.maps){res();return;}
    const s=document.createElement('script'); s.src=`https://maps.googleapis.com/maps/api/js?key=${CFG.apiKey}&libraries=places`; s.async=true; s.onload=res; s.onerror=()=>rej(new Error('Google Maps failed')); document.head.appendChild(s);
  });
}
function initGoogle(){
  usingGoogle=true; byId('leaflet').style.display='none'; byId('gmap').style.display='block';
  gmap=new google.maps.Map(byId('gmap'),{center:{lat:40.73,lng:-73.98},zoom:12,mapTypeControl:true,streetViewControl:true});
  gPlaces=new google.maps.places.PlacesService(gmap); gGeo=new google.maps.Geocoder(); gDS=new google.maps.DistanceMatrixService(); gDR=new google.maps.DirectionsRenderer({suppressMarkers:true,preserveViewport:true}); gDR.setMap(gmap);
}
function initLeaflet(){ usingGoogle=false; byId('gmap').style.display='none'; byId('leaflet').style.display='block'; if(!lmap){ lmap=L.map('leaflet').setView([40.73,-73.98],12); L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19,attribution:'&copy; OpenStreetMap'}).addTo(lmap); lLayer=L.layerGroup().addTo(lmap);} }

function clearMap(){ if(usingGoogle){ Object.values(mainMarkers).forEach(m=>m.setMap(null)); Object.values(microMarkers).forEach(a=>a.forEach(m=>m.setMap(null))); Object.values(arrowPolylines).forEach(a=>a.forEach(p=>p.setMap(null))); mainMarkers={}; microMarkers={}; arrowPolylines={}; } else if(lLayer){ lLayer.clearLayers(); mainMarkers={}; microMarkers={}; arrowPolylines={}; } }
function blockColor(b){return b==='Morning'?'#60a5fa':b==='Afternoon'?'#fbbf24':b==='Evening'?'#a78bfa':'#fb7185';}

function renderMarkers(){
  if(usingGoogle&&!gmap) return; if(!usingGoogle&&!lmap) return; clearMap();
  const list=visible();
  if(usingGoogle){
    const B=new google.maps.LatLngBounds();
    list.forEach(loc=>{
      const a=activeAnchor(loc);
      const mm=new google.maps.Marker({map:gmap,position:{lat:a.lat,lng:a.lon},title:loc.name,icon:{path:google.maps.SymbolPath.CIRCLE,scale:6,fillColor:blockColor(loc.block),fillOpacity:1,strokeColor:'#0b1220',strokeWeight:2}});
      mainMarkers[loc.id]=mm; B.extend(mm.getPosition());
      const micro=computeMicroAbs(loc);
      microMarkers[loc.id]=micro.map(mp=> new google.maps.Marker({map:gmap,position:{lat:mp.lat,lng:mp.lon},title:mp.title,icon:{path:google.maps.SymbolPath.CIRCLE,scale:4,fillColor:'#2dd4bf',fillOpacity:1,strokeColor:'#093b36',strokeWeight:1}}) );
      // subject-based arrows (from card bearing)
      if(!arrowPolylines[loc.id]) arrowPolylines[loc.id]=[];
      const m=(loc.bearing||'').match(/\b(NNW|NW|WNW|W|WSW|SW|SSW|S|SSE|SE|ESE|E|ENE|NE|NNE|N)\b/);
      const map={N:0,NNE:22.5,NE:45,ENE:67.5,E:90,ESE:112.5,SE:135,SSE:157.5,S:180,SSW:202.5,SW:225,WSW:247.5,W:270,WNW:292.5,NW:315,NNW:337.5};
      const bMain = map[m?m[1]:'N']||0;
      micro.forEach(mp=>{
        const dlat=(20*Math.cos(bMain*Math.PI/180))/111111.0;
        const dlon=(20*Math.sin(bMain*Math.PI/180))/(111111.0*Math.cos(mp.lat*Math.PI/180));
        const end={lat:+(mp.lat+dlat).toFixed(6), lng:+(mp.lon+dlon).toFixed(6)};
        const pl=new google.maps.Polyline({path:[{lat:mp.lat,lng:mp.lon}, end], strokeColor:'#2dd4bf', strokeOpacity:.9, strokeWeight:2,
          icons:[{icon:{path:google.maps.SymbolPath.FORWARD_CLOSED_ARROW,scale:2,strokeColor:'#2dd4bf',strokeOpacity:.9},offset:'100%'}]});
        pl.setMap(gmap); arrowPolylines[loc.id].push(pl);
      });
      if(state.editMode){ mm.setDraggable(true); mm.addListener('dragend',ev=>{ const p=ev.latLng; a.lat=+(p.lat().toFixed(6)); a.lon=+(p.lng().toFixed(6)); saveLocal(); renderMarkers(); renderList(); }); }
    });
    if(!B.isEmpty()) gmap.fitBounds(B,90);
  } else {
    const pts=[];
    list.forEach(loc=>{ const a=activeAnchor(loc); L.circleMarker([a.lat,a.lon],{radius:8,weight:2,color:blockColor(loc.block),fillColor:blockColor(loc.block),fillOpacity:.95}).addTo(lLayer); pts.push([a.lat,a.lon]); computeMicroAbs(loc).forEach(mp=> L.circleMarker([mp.lat,mp.lon],{radius:4,weight:1,color:'#2dd4bf',fillColor:'#2dd4bf',fillOpacity:.95}).addTo(lLayer)); });
    if(pts.length) lmap.fitBounds(pts,{padding:[90,90]});
  }
}

// Places photos
function loadRef(container, loc){
  if(!usingGoogle||!gPlaces){ container.textContent='Switch to Google mode to load images.'; return; }
  const a=activeAnchor(loc), query=loc.placeQuery||loc.name;
  gPlaces.findPlaceFromQuery({query,fields:['place_id','name'],locationBias:{radius:300,center:{lat:a.lat,lng:a.lon}}}, (res,st)=>{
    if(st!=='OK'||!res||!res[0]){ container.textContent='No images found.'; return; }
    gPlaces.getDetails({placeId:res[0].place_id,fields:['name','photos','url']}, (det,st2)=>{
      if(st2!=='OK'||!det){ container.textContent='No images available.'; return; }
      const grid=document.createElement('div'); grid.className='ref-grid';
      (det.photos||[]).slice(0,12).forEach(p=>{ const img=document.createElement('img'); img.loading='lazy'; img.src=p.getUrl({maxWidth:400,maxHeight:400}); img.title=det.name; img.addEventListener('click',()=>window.open(det.url,'_blank')); grid.appendChild(img); });
      container.innerHTML=''; grid.childElementCount?container.appendChild(grid):container.textContent='No images.';
    });
  });
}

// Reverse geocode
function revGeocode(lat,lon,cb){ if(!usingGoogle||!gGeo){ cb(''); return; } gGeo.geocode({location:{lat,lng:lon}},(res,st)=>cb(st==='OK'&&res[0]?res[0].formatted_address:'')); }

// ETA/Route
let myMarker=null;
function geolocate(cb){
  if(!navigator.geolocation){ alert('Geolocation not supported'); return; }
  navigator.geolocation.getCurrentPosition(pos=>{
    const pt={lat:pos.coords.latitude,lng:pos.coords.longitude};
    if(usingGoogle){
      if(!myMarker) myMarker=new google.maps.Marker({map:gmap,position:pt,icon:{path:google.maps.SymbolPath.CIRCLE,scale:5,fillColor:'#34d399',fillOpacity:1,strokeColor:'#034d36',strokeWeight:2}});
      else myMarker.setPosition(pt);
      gmap.panTo(pt);
    } else {
      if(myMarker){ lLayer.removeLayer(myMarker); }
      myMarker=L.circleMarker([pt.lat,pt.lng],{radius:6,color:'#34d399',fillColor:'#34d399',fillOpacity:1}).addTo(lLayer);
      lmap.panTo([pt.lat,pt.lng]);
    }
    cb&&cb(pt);
  }, err=> alert('Geolocation error: '+err.message), {enableHighAccuracy:true,timeout:10000,maximumAge:30000});
}
function etaTo(loc){
  if(!usingGoogle){ alert('Switch to Google mode (button above Light panel)'); return; }
  geolocate(pt=>{
    const a=activeAnchor(loc); new google.maps.DistanceMatrixService().getDistanceMatrix({origins:[pt],destinations:[{lat:a.lat,lng:a.lon}],travelMode:'WALKING'},(re,st)=>{
      if(st==='OK'){ const el=re.rows[0].elements[0]; alert(`Walking ETA: ${el.duration.text} • ${el.distance.text}`);} else alert('DistanceMatrix failed: '+st);
    });
  });
}
function routeTo(loc){
  if(!usingGoogle){ alert('Switch to Google mode (button above Light panel)'); return; }
  geolocate(pt=>{
    const a=activeAnchor(loc); const dir=new google.maps.DirectionsService(); const ren=new google.maps.DirectionsRenderer({suppressMarkers:true,preserveViewport:true}); ren.setMap(gmap);
    dir.route({origin:pt,destination:{lat:a.lat,lng:a.lon},travelMode:'WALKING'}, (re,st)=> st==='OK'?ren.setDirections(re):alert('Directions failed: '+st));
  });
}

// UI
function timing(l){const t=TIMES[l.day]; if(!t) return ''; if(l.block==='Morning') return `Arrive 6:00–7:30 am • Civil dawn ${t.dawn} • Sunrise ${t.sunrise}`; if(l.block==='Afternoon') return `Best 12:00–3:30 pm`; if(l.block==='Evening') return `Arrive 5:30–7:00 pm • Sunset ${t.sunset} • Civil dusk ${t.dusk}`; if(l.block==='Night') return `Start 6:50–9:00 pm • Civil dusk ${t.dusk} • Moonrise ${t.moonrise}`; return '';}
function expList(arr){const ul=document.createElement('ul'); ul.style.listStyle='none'; ul.style.paddingLeft='0'; (arr||[]).forEach(x=>{ const li=document.createElement('li'); li.style.margin='.35rem 0'; const btn=document.createElement('button'); btn.className='pill'; btn.textContent=x.title; const body=document.createElement('div'); body.style.display='none'; body.style.marginTop='.35rem'; body.textContent=x.detail||''; btn.onclick=()=> body.style.display=body.style.display==='none'?'block':'none'; li.appendChild(btn); li.appendChild(body); ul.appendChild(li); }); return ul; }

function card(l){
  const a=activeAnchor(l); const c=document.createElement('div'); c.className='card';
  c.innerHTML=`<h3>${l.name}<span class="badge ${l.block}">${l.block}</span><span class="badge">Rank #${l.rank}</span></h3>
  <div class="kv"><div class="k">Why now</div><div>${l.whyNow||''}</div><div class="k">Timing</div><div>${timing(l)}</div><div class="k">Face & light</div><div>${l.bearing||''}</div><div class="k">Gear</div><div>${l.gear||''}</div></div>
  <div class="pillset" id="anc"></div>
  <div class="pillset"><a class="pill" href="https://www.google.com/maps/search/?api=1&query=${a.lat},${a.lon}" target="_blank">Open (anchor)</a><a class="pill" href="https://www.google.com/maps/dir/?api=1&destination=${a.lat},${a.lon}&travelmode=walking" target="_blank">Walk to anchor</a><button class="pill" id="show">Show on map</button><button class="pill" id="eta">ETA</button><button class="pill" id="route">Route</button></div>
  <div class="pillset" id="micros"></div>
  <div class="kv" id="kvMore"></div>
  <details><summary>Pins, shots, settings & reference images</summary><div id="pins"></div><div id="shots"></div><div style="margin:.5rem 0"><button class="pill" id="refBtn">Reference Images</button></div><div id="refImgs"></div></details>`;

  const anc=c.querySelector('#anc');
  (l.anchors||[]).forEach((an,i)=>{ const b=document.createElement('button'); b.className='pill'; b.textContent=an.label+(i===l.activeAnchor?' ✓':''); b.onclick=()=>{ l.activeAnchor=i; saveLocal(); renderMarkers(); renderList(); }; anc.appendChild(b); });
  const micro=c.querySelector('#micros'); computeMicroAbs(l).forEach(mp=>{ const a=document.createElement('a'); a.className='pill'; a.textContent=mp.title; a.href=`https://www.google.com/maps/dir/?api=1&destination=${mp.lat},${mp.lon}&travelmode=walking`; a.target='_blank'; micro.appendChild(a); });
  c.querySelector('#pins').appendChild(expList(l.pins)); c.querySelector('#shots').appendChild(expList(l.shots));

  const more=c.querySelector('#kvMore'); const t=TIMES[l.day];
  more.innerHTML=`<div class="k">Tides (Battery)</div><div id="tide">Loading…</div><div class="k">Moon</div><div>Rise ${t.moonrise} • Set ${t.moonset} • ${t.illum}</div><div class="k">Address</div><div id="addrTxt"></div>`;
  fetchNOAA(state.dayMap[l.day]).then(s=>c.querySelector('#tide').innerText=s);
  revGeocode(a.lat,a.lon,addr=> c.querySelector('#addrTxt').innerText=addr||'');

  // actions
  c.querySelector('#show').onclick=()=>{ if(usingGoogle){ const B=new google.maps.LatLngBounds(); const A=activeAnchor(l); B.extend({lat:A.lat,lng:A.lon}); computeMicroAbs(l).forEach(mp=>B.extend({lat:mp.lat,lng:mp.lon})); gmap.fitBounds(B,120); } else { const pts=computeMicroAbs(l).map(mp=>[mp.lat,mp.lon]); const A=activeAnchor(l); pts.push([A.lat,A.lon]); lmap.fitBounds(pts,{padding:[120,120]}); } };
  c.querySelector('#eta').onclick=()=>etaTo(l);
  c.querySelector('#route').onclick=()=>routeTo(l);
  c.querySelector('#refBtn').onclick=()=>loadRef(c.querySelector('#refImgs'),l);
  return c;
}

function renderLight(){ computeTimes(); const root=byId('#lightpanels'); root.innerHTML=''; ['2025-10-03','2025-10-04'].forEach(k=>{const t=TIMES[k]; const p=document.createElement('div'); p.className='panel'; p.innerHTML=`<div class="section-title">${dayLabel(state.dayMap[k])} — Light • Moon • Tides</div><div class="kv"><div class="k">Civil dawn</div><div>${t.dawn}</div><div class="k">Sunrise</div><div>${t.sunrise}</div><div class="k">Sunset</div><div>${t.sunset}</div><div class="k">Civil dusk</div><div>${t.dusk}</div><div class="k">Moon</div><div>Rise ${t.moonrise} • Set ${t.moonset} • ${t.illum}</div></div>`; root.appendChild(p); }); }
function renderList(){ const list=byId('#list'); list.innerHTML=''; const groups=new Map(); visible().forEach(l=>{const key=dayLabel(state.dayMap[l.day])+' | '+l.block; if(!groups.has(key)) groups.set(key,[]); groups.get(key).push(l);}); for(const [key,arr] of groups){ const [label,block]=key.split(' | '); const sec=document.createElement('section'); sec.className='panel'; sec.innerHTML=`<div class="section-title">${label} — ${block}</div>`; const grid=document.createElement('div'); grid.className='grid'; arr.sort((a,b)=>a.rank-b.rank).forEach(l=> grid.appendChild(card(l))); sec.appendChild(grid); list.appendChild(sec);} renderMarkers(); }

function saveLocal(){ localStorage.setItem(CFG.store, JSON.stringify({LOCATIONS, state:{dayMap:state.dayMap}})); }
function loadLocal(){ try{ const s=localStorage.getItem(CFG.store); if(s){ const o=JSON.parse(s); if(o.LOCATIONS) LOCATIONS=o.LOCATIONS; if(o.state&&o.state.dayMap) state.dayMap=o.state.dayMap; } }catch(e){} }

async function boot(){
  loadLocal();
  // Header controls
  byId('#dateA').value=state.dayMap['2025-10-03']; byId('#dateB').value=state.dayMap['2025-10-04'];
  byId('#dateA').onchange=e=>{state.dayMap['2025-10-03']=e.target.value; saveLocal(); renderLight(); renderList();};
  byId('#dateB').onchange=e=>{state.dayMap['2025-10-04']=e.target.value; saveLocal(); renderLight(); renderList();};
  document.querySelectorAll('input[name="day"]').forEach(cb=> cb.onchange=e=>{const v=e.target.value; if(e.target.checked) state.day.add(v); else state.day.delete(v); renderList(); renderMarkers();});
  document.querySelectorAll('input[name="block"]').forEach(cb=> cb.onchange=e=>{const v=e.target.value; if(e.target.checked) state.blocks.add(v); else state.blocks.delete(v); renderList(); renderMarkers();});
  const rmin=byId('#rankMin'), rmax=byId('#rankMax'); [rmin,rmax].forEach(i=> i.oninput=()=>{ state.rankMin=+rmin.value; state.rankMax=+rmax.value; byId('#rankLabel').textContent=`#${state.rankMin}–#${state.rankMax}`; renderList(); renderMarkers(); });
  byId('#proOnly').onchange=e=>{ state.proOnly=e.target.checked; renderList(); };
  byId('#rain').onchange=e=>{ state.rain=e.target.checked; renderList(); };
  byId('#wind').onchange=e=>{ state.wind=e.target.checked; renderList(); };
  byId('#q').oninput=e=>{ state.q=e.target.value; renderList(); };
  byId('#expandAll').onclick=()=>{ state.expandAll=true; renderList(); };
  byId('#collapseAll').onclick=()=>{ state.expandAll=false; renderList(); };
  byId('#exportCSV').onclick=exportCSV; byId('#exportKML').onclick=exportKML; byId('#print').onclick=()=>window.print();
  byId('#theme').onclick=toggleTheme;
  byId('#exportJSON').onclick=()=>{ const blob=new Blob([JSON.stringify({LOCATIONS,state},null,2)],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='NYC_Photo_Guide_v8.json'; a.click(); setTimeout(()=>URL.revokeObjectURL(a.href),1500); };
  byId('#importJSON').onchange=e=>{ if(e.target.files[0]){ const r=new FileReader(); r.onload=()=>{ try{ const obj=JSON.parse(r.result); if(obj.LOCATIONS) LOCATIONS=obj.LOCATIONS; if(obj.state&&obj.state.dayMap) state.dayMap=obj.state.dayMap; saveLocal(); renderLight(); renderList(); renderMarkers(); }catch(err){ alert('Invalid JSON'); } }; r.readAsText(e.target.files[0]); } };
  byId('#modeGoogle').onclick=async()=>{ try{ await injectGoogle(); initGoogle(); document.getElementById('modeGoogle').classList.add('active'); document.getElementById('modeLeaflet').classList.remove('active'); renderMarkers(); }catch(e){ alert('Google Maps failed to load'); } };
  byId('#modeLeaflet').onclick=()=>{ initLeaflet(); document.getElementById('modeLeaflet').classList.add('active'); document.getElementById('modeGoogle').classList.remove('active'); renderMarkers(); };

  renderLight();
  // Try Google first, fallback to Leaflet
  try{ await injectGoogle(); initGoogle(); document.getElementById('modeGoogle').classList.add('active'); } catch(e){ initLeaflet(); document.getElementById('modeLeaflet').classList.add('active'); }
  renderList();
}

function toggleTheme(){
  const root=document.documentElement, dark=getComputedStyle(root).getPropertyValue('--bg').trim()==='#0b1220';
  if(dark){ root.style.setProperty('--bg','#f6f8fb'); root.style.setProperty('--panel','#ffffff'); root.style.setProperty('--card','#ffffff'); root.style.setProperty('--text','#0b1220'); root.style.setProperty('--muted','#465a77'); root.style.setProperty('--border','#d7e1ef'); }
  else { root.style.setProperty('--bg','#0b1220'); root.style.setProperty('--panel','#0f172a'); root.style.setProperty('--card','#0e1426'); root.style.setProperty('--text','#e6edf6'); root.style.setProperty('--muted','#9bb0c9'); root.style.setProperty('--border','#1f2a44'); }
}

// Exports
function exportCSV(){
  const rows=[["dayLabel","block","rank","name","activeAnchor","anchorLat","anchorLon"]];
  visible().forEach(l=>{ const a=activeAnchor(l); rows.push([dayLabel(state.dayMap[l.day]), l.block, l.rank, l.name, a.label, a.lat, a.lon]); });
  const csv=rows.map(r=>r.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(",")).join("\n");
  const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([csv],{type:'text/plain'})); a.download='NYC_Photo_Guide_Anchors.csv'; a.click();
}
function exportKML(){
  let kml=`<?xml version="1.0" encoding="UTF-8"?>\n<kml xmlns="http://www.opengis.net/kml/2.2"><Document><name>NYC Photo Pins (Anchors+Micro)</name>`;
  visible().forEach(p=>{ const a=activeAnchor(p); const desc=`${dayLabel(state.dayMap[p.day])} • ${p.block} • Rank ${p.rank}`; kml+=`<Placemark><name>${p.name} — ${a.label}</name><description><![CDATA[${desc}]]></description><Point><coordinates>${a.lon},${a.lat},0</coordinates></Point></Placemark>`; computeMicroAbs(p).forEach(mp=>{ const d2=`${p.name} / ${mp.title}`; kml+=`<Placemark><name>${p.name} — ${mp.title}</name><description><![CDATA[${d2}]]></description><Point><coordinates>${mp.lon},${mp.lat},0</coordinates></Point></Placemark>`; }); });
  kml+='</Document></kml>'; const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([kml],{type:'text/plain'})); a.download='NYC_Photo_Pins.kml'; a.click();
}

window.addEventListener('DOMContentLoaded', boot);

</script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</body>
</html>
